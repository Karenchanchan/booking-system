<!doctype html>
<html lang="zh-HK" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Room Booking System æˆ¿é–“é ç´„ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&amp;family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .card-shadow {
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    .time-slot {
      transition: all 0.2s ease;
    }
    .time-slot:hover:not(.booked):not(.selected) {
      transform: scale(1.05);
      background: #e0e7ff;
    }
    .time-slot.selected {
      background: #4f46e5;
      color: white;
    }
    .time-slot.booked {
      background: #fee2e2;
      color: #991b1b;
      cursor: not-allowed;
    }
    @media print {
      .no-print { display: none !important; }
      .print-only { display: block !important; }
      body { background: white !important; }
      .card-shadow { box-shadow: none !important; }
    }
    .print-only { display: none; }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gray-50">
  <div id="app" class="h-full overflow-auto"><!-- Login Screen -->
   <div id="loginScreen" class="min-h-full flex items-center justify-center p-4">
    <div class="w-full max-w-md">
     <div class="text-center mb-8">
      <div class="w-20 h-20 mx-auto mb-4 rounded-2xl gradient-bg flex items-center justify-center">
       <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
       </svg>
      </div>
      <h1 id="systemTitle" class="text-3xl font-bold text-gray-800">Room Booking System</h1>
      <p class="text-gray-500 mt-2">æˆ¿é–“é ç´„ç³»çµ±</p>
     </div>
     <div class="bg-white rounded-2xl card-shadow p-8">
      <div class="space-y-6">
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Name å§“å</label> <input type="text" id="loginName" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" placeholder="Enter your name è¼¸å…¥å§“å">
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Password å¯†ç¢¼</label> <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" placeholder="Enter password è¼¸å…¥å¯†ç¢¼">
       </div>
       <div id="loginError" class="hidden text-red-500 text-sm text-center"></div><button onclick="handleLogin()" class="w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-xl transition transform hover:scale-[1.02]"> Login ç™»å…¥ </button>
      </div>
      <div class="mt-6 pt-6 border-t border-gray-100"><button onclick="showStaffLogin()" class="w-full py-3 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-xl transition"> Staff Login å·¥ä½œäººå“¡ç™»å…¥ </button>
      </div>
     </div>
    </div>
   </div><!-- Renter Dashboard -->
   <div id="renterDashboard" class="hidden min-h-full">
    <nav class="gradient-bg text-white p-4 no-print">
     <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div>
       <h1 class="text-xl font-bold">Welcome æ­¡è¿, <span id="renterNameDisplay"></span></h1>
       <p class="text-indigo-200 text-sm">Renter Dashboard ç§Ÿç”¨è€…ä»‹é¢</p>
      </div><button onclick="logout()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition"> Logout ç™»å‡º </button>
     </div>
    </nav>
    <div class="max-w-7xl mx-auto p-4 space-y-6"><!-- Branch and Room Selection -->
     <div class="bg-white rounded-2xl card-shadow p-6">
      <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ Select Branch &amp; Room é¸æ“‡åˆ†åº—åŠæˆ¿é–“</h2>
      <div class="grid md:grid-cols-2 gap-4 mb-4">
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Branch åˆ†åº—</label> <select id="branchSelect" onchange="updateRoomList()" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500"> <option value="">Select Branch é¸æ“‡åˆ†åº—</option> <option value="jordan">ä½æ•¦ Jordan</option> <option value="wanchai">ç£ä»” Wan Chai</option> <option value="tsuenwan">èƒç£ Tsuen Wan</option> </select>
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Date æ—¥æœŸ</label> <input type="date" id="bookingDate" onchange="loadTimeSlots()" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500">
       </div>
      </div>
      <div id="roomList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
     </div><!-- Time Slot Selection -->
     <div id="timeSlotSection" class="hidden bg-white rounded-2xl card-shadow p-6">
      <h2 class="text-xl font-bold text-gray-800 mb-2">ğŸ• Select Time é¸æ“‡æ™‚é–“</h2>
      <p id="selectedRoomInfo" class="text-gray-600 mb-4"></p>
      <div id="toyRentalOption" class="hidden mb-4 p-4 bg-amber-50 rounded-xl border border-amber-200"><label class="flex items-center space-x-3 cursor-pointer"> <input type="checkbox" id="toyRentalCheckbox" onchange="updatePriceDisplay()" class="w-5 h-5 text-indigo-600 rounded"> <span class="text-amber-800 font-medium"> <span id="toyRentalText">Add Toy Rental åŠ ç§Ÿç©å…·</span> <span id="toyPriceDisplay" class="text-amber-600"></span> </span> </label>
      </div>
      <div class="grid md:grid-cols-2 gap-4 mb-4">
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Start Time é–‹å§‹æ™‚é–“</label> <select id="startTimeSelect" onchange="updateEndTimeOptions()" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500"> <option value="">Select start time é¸æ“‡é–‹å§‹æ™‚é–“</option> </select>
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">End Time çµæŸæ™‚é–“</label> <select id="endTimeSelect" onchange="updatePriceDisplay()" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500"> <option value="">Select end time é¸æ“‡çµæŸæ™‚é–“</option> </select>
       </div>
      </div>
      <div id="bookedSlotsWarning" class="hidden mb-4 p-4 bg-red-50 rounded-xl border border-red-200">
       <p class="text-red-700 font-medium">âš ï¸ Some time slots are already booked éƒ¨åˆ†æ™‚æ®µå·²è¢«é ç´„</p>
       <p class="text-red-600 text-sm mt-1">Booked times å·²é ç´„æ™‚æ®µ: <span id="bookedTimesList"></span></p>
      </div>
      <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-100">
       <div>
        <p class="text-gray-600">Duration æ™‚é•·: <span id="durationDisplay" class="font-bold text-indigo-600">0</span> hours å°æ™‚</p>
        <p class="text-gray-600">Total ç¸½è¨ˆ: <span id="totalPriceDisplay" class="font-bold text-indigo-600">$0</span></p>
       </div><button onclick="confirmBooking()" id="confirmBookingBtn" disabled class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium rounded-xl transition"> Confirm Booking ç¢ºèªé ç´„ </button>
      </div>
     </div><!-- Monthly Statistics -->
     <div class="bg-white rounded-2xl card-shadow p-6">
      <div class="flex justify-between items-center mb-4">
       <h2 class="text-xl font-bold text-gray-800">ğŸ“Š Rental Statistics ç§Ÿç”¨çµ±è¨ˆ</h2>
       <div class="flex items-center space-x-2"><select id="statsMonth" onchange="updateRenterStats()" class="px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500"> </select> <select id="statsYear" onchange="updateRenterStats()" class="px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500"> </select> <button onclick="downloadRenterReport()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-xl transition flex items-center space-x-2"> <span>ğŸ“¥</span> <span>Download ä¸‹è¼‰</span> </button>
       </div>
      </div>
      <div class="grid md:grid-cols-3 gap-4 mb-6">
       <div class="bg-indigo-50 rounded-xl p-4 text-center">
        <p class="text-indigo-600 text-sm">Total Hours ç¸½æ™‚æ•¸</p>
        <p id="statsTotalHours" class="text-3xl font-bold text-indigo-700">0</p>
       </div>
       <div class="bg-green-50 rounded-xl p-4 text-center">
        <p class="text-green-600 text-sm">Bookings é ç´„æ¬¡æ•¸</p>
        <p id="statsTotalBookings" class="text-3xl font-bold text-green-700">0</p>
       </div>
       <div class="bg-amber-50 rounded-xl p-4 text-center">
        <p class="text-amber-600 text-sm">Total Amount ç¸½é‡‘é¡</p>
        <p id="statsTotalAmount" class="text-3xl font-bold text-amber-700">$0</p>
       </div>
      </div>
      <div id="renterBookingsList" class="space-y-2 max-h-96 overflow-auto"></div>
      <div class="mt-4 text-sm text-gray-500 text-center">
       â„¹ï¸ Click the âœ• button to cancel a booking é»æ“Š âœ• æŒ‰éˆ•å–æ¶ˆé ç´„
      </div>
     </div>
    </div>
   </div><!-- Staff Dashboard -->
   <div id="staffDashboard" class="hidden min-h-full">
    <nav class="bg-slate-800 text-white p-4 no-print">
     <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div>
       <h1 class="text-xl font-bold">Staff Dashboard å·¥ä½œäººå“¡ä»‹é¢</h1>
       <p class="text-slate-400 text-sm">Management Console ç®¡ç†æ§åˆ¶å°</p>
      </div><button onclick="logout()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition"> Logout ç™»å‡º </button>
     </div>
    </nav>
    <div class="max-w-7xl mx-auto p-4"><!-- Staff Tabs -->
     <div class="flex space-x-2 mb-6 overflow-x-auto no-print"><button onclick="showStaffTab('renters')" class="staff-tab px-4 py-2 rounded-lg font-medium transition bg-indigo-600 text-white" data-tab="renters"> ğŸ‘¥ Renters ç§Ÿç”¨è€… </button> <button onclick="showStaffTab('rooms')" class="staff-tab px-4 py-2 rounded-lg font-medium transition bg-gray-200 text-gray-700" data-tab="rooms"> ğŸ  Rooms æˆ¿é–“ </button> <button onclick="showStaffTab('bookings')" class="staff-tab px-4 py-2 rounded-lg font-medium transition bg-gray-200 text-gray-700" data-tab="bookings"> ğŸ“… All Bookings æ‰€æœ‰é ç´„ </button> <button onclick="showStaffTab('reports')" class="staff-tab px-4 py-2 rounded-lg font-medium transition bg-gray-200 text-gray-700" data-tab="reports"> ğŸ“Š Reports å ±è¡¨ </button>
     </div><!-- Renters Management -->
     <div id="staffRentersTab" class="staff-tab-content">
      <div class="bg-white rounded-2xl card-shadow p-6 mb-6">
       <h2 class="text-xl font-bold text-gray-800 mb-4">Add New Renter æ–°å¢ç§Ÿç”¨è€…</h2>
       <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4"><input type="text" id="newRenterName" placeholder="Name å§“å" class="px-4 py-3 border border-gray-200 rounded-xl"> <input type="text" id="newRenterPassword" placeholder="Password å¯†ç¢¼" class="px-4 py-3 border border-gray-200 rounded-xl"> <input type="email" id="newRenterEmail" placeholder="Email é›»éƒµ" class="px-4 py-3 border border-gray-200 rounded-xl"> <input type="tel" id="newRenterPhone" placeholder="Phone é›»è©±" class="px-4 py-3 border border-gray-200 rounded-xl">
       </div><button onclick="addNewRenter()" class="mt-4 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-xl transition"> Add Renter æ–°å¢ç§Ÿç”¨è€… </button>
      </div>
      <div class="bg-white rounded-2xl card-shadow p-6">
       <h2 class="text-xl font-bold text-gray-800 mb-4">Renter List ç§Ÿç”¨è€…åˆ—è¡¨</h2>
       <div id="renterList" class="space-y-3"></div>
      </div>
     </div><!-- Rooms Management -->
     <div id="staffRoomsTab" class="staff-tab-content hidden">
      <div class="bg-white rounded-2xl card-shadow p-6">
       <h2 class="text-xl font-bold text-gray-800 mb-4">Room Pricing Management æˆ¿é–“åƒ¹æ ¼ç®¡ç†</h2>
       <p class="text-gray-600 mb-4 text-sm">âš ï¸ Price changes only affect new bookings åƒ¹æ ¼è®Šæ›´åªå½±éŸ¿æ–°é ç´„</p>
       <div class="space-y-6"><!-- Jordan -->
        <div>
         <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center"><span class="w-3 h-3 bg-indigo-500 rounded-full mr-2"></span> ä½æ•¦ Jordan</h3>
         <div id="jordanRooms" class="grid md:grid-cols-2 gap-4"></div>
        </div><!-- Wan Chai -->
        <div>
         <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center"><span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span> ç£ä»” Wan Chai</h3>
         <div id="wanchaiRooms" class="grid md:grid-cols-2 gap-4"></div>
        </div><!-- Tsuen Wan -->
        <div>
         <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center"><span class="w-3 h-3 bg-amber-500 rounded-full mr-2"></span> èƒç£ Tsuen Wan</h3>
         <div id="tsuenwanRooms" class="grid md:grid-cols-2 gap-4"></div>
        </div>
       </div>
      </div>
     </div><!-- All Bookings -->
     <div id="staffBookingsTab" class="staff-tab-content hidden">
      <div class="bg-white rounded-2xl card-shadow p-6">
       <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
        <h2 class="text-xl font-bold text-gray-800">All Bookings æ‰€æœ‰é ç´„</h2>
        <div class="flex items-center space-x-2"><select id="bookingsFilterMonth" onchange="filterBookings()" class="px-4 py-2 border border-gray-200 rounded-xl"> </select> <select id="bookingsFilterYear" onchange="filterBookings()" class="px-4 py-2 border border-gray-200 rounded-xl"> </select> <select id="bookingsFilterRenter" onchange="filterBookings()" class="px-4 py-2 border border-gray-200 rounded-xl"> <option value="">All Renters æ‰€æœ‰ç§Ÿç”¨è€…</option> </select> <button onclick="downloadAllBookings()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-xl transition"> ğŸ“¥ Download ä¸‹è¼‰ </button>
        </div>
       </div>
       <div id="allBookingsList" class="space-y-2 max-h-[600px] overflow-auto"></div>
      </div>
     </div><!-- Reports -->
     <div id="staffReportsTab" class="staff-tab-content hidden">
      <div class="bg-white rounded-2xl card-shadow p-6 mb-6">
       <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
        <h2 class="text-xl font-bold text-gray-800">Monthly Report æœˆçµå ±è¡¨</h2>
        <div class="flex items-center space-x-2 no-print"><select id="reportMonth" onchange="generateReport()" class="px-4 py-2 border border-gray-200 rounded-xl"> </select> <select id="reportYear" onchange="generateReport()" class="px-4 py-2 border border-gray-200 rounded-xl"> </select> <button onclick="window.print()" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition"> ğŸ–¨ï¸ Print åˆ—å° </button>
        </div>
       </div>
       <div id="reportContent">
        <div class="print-only text-center mb-6">
         <h1 class="text-2xl font-bold">Room Rental Report æˆ¿é–“ç§Ÿç”¨å ±è¡¨</h1>
         <p id="reportPeriod" class="text-gray-600"></p>
        </div>
        <div class="grid md:grid-cols-4 gap-4 mb-6">
         <div class="bg-indigo-50 rounded-xl p-4 text-center">
          <p class="text-indigo-600 text-sm">Total Revenue ç¸½æ”¶å…¥</p>
          <p id="reportTotalRevenue" class="text-2xl font-bold text-indigo-700">$0</p>
         </div>
         <div class="bg-green-50 rounded-xl p-4 text-center">
          <p class="text-green-600 text-sm">Total Bookings ç¸½é ç´„</p>
          <p id="reportTotalBookings" class="text-2xl font-bold text-green-700">0</p>
         </div>
         <div class="bg-amber-50 rounded-xl p-4 text-center">
          <p class="text-amber-600 text-sm">Total Hours ç¸½æ™‚æ•¸</p>
          <p id="reportTotalHours" class="text-2xl font-bold text-amber-700">0</p>
         </div>
         <div class="bg-purple-50 rounded-xl p-4 text-center">
          <p class="text-purple-600 text-sm">Active Renters æ´»èºç§Ÿç”¨è€…</p>
          <p id="reportActiveRenters" class="text-2xl font-bold text-purple-700">0</p>
         </div>
        </div>
        <h3 class="text-lg font-semibold text-gray-700 mb-3">By Renter æŒ‰ç§Ÿç”¨è€…</h3>
        <div id="reportByRenter" class="space-y-4 mb-6"></div>
        <h3 class="text-lg font-semibold text-gray-700 mb-3">By Room æŒ‰æˆ¿é–“</h3>
        <div id="reportByRoom" class="space-y-2"></div>
       </div>
      </div><!-- Individual Receipts -->
      <div class="bg-white rounded-2xl card-shadow p-6 no-print">
       <h2 class="text-xl font-bold text-gray-800 mb-4">Generate Receipt ç”Ÿæˆæ”¶æ“š</h2>
       <div class="flex items-center space-x-4"><select id="receiptRenter" class="px-4 py-2 border border-gray-200 rounded-xl flex-1"> <option value="">Select Renter é¸æ“‡ç§Ÿç”¨è€…</option> </select> <select id="receiptMonth" class="px-4 py-2 border border-gray-200 rounded-xl"> </select> <select id="receiptYear" class="px-4 py-2 border border-gray-200 rounded-xl"> </select> <button onclick="generateReceipt()" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-xl transition"> Generate ç”Ÿæˆ </button>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Receipt Modal -->
   <div id="receiptModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-auto p-8">
     <div id="receiptContent"></div>
     <div class="flex justify-end space-x-4 mt-6 no-print"><button onclick="closeReceiptModal()" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 rounded-xl transition"> Close é—œé–‰ </button> <button onclick="printReceipt()" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition"> ğŸ“¥ Download CSV ä¸‹è¼‰CSV </button>
     </div>
    </div>
   </div><!-- Confirmation Modal -->
   <div id="confirmModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl max-w-md w-full p-6">
     <h3 class="text-lg font-bold text-gray-800 mb-2">Confirm Cancellation ç¢ºèªå–æ¶ˆ</h3>
     <p id="confirmMessage" class="text-gray-600 mb-6"></p>
     <div class="flex space-x-3"><button onclick="closeConfirmModal()" class="flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-xl transition"> Cancel å–æ¶ˆ </button> <button onclick="confirmDelete()" class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-xl transition"> Confirm ç¢ºèª </button>
     </div>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="hidden fixed bottom-4 right-4 px-6 py-4 rounded-xl shadow-lg z-50 transition-all transform translate-y-full"></div>
  </div>
  <script>
    // ============ DATA & STATE ============
    let allData = [];
    let currentUser = null;
    let currentUserType = null;
    let selectedRoom = null;
    let selectedTimeSlots = [];
    let pendingDeleteAction = null;
    
    const defaultConfig = {
      system_title: 'Room Booking System'
    };
    
    const defaultRooms = {
      jordan: [
        { id: 'room-c', name: 'Room C', pricePerHour: 140, facilities: 'å‚¬çœ æ¤… Hypnosis Chair', hasToyOption: false, toyRentalPrice: 0 },
        { id: 'room-d', name: 'Room D', pricePerHour: 190, facilities: 'å°çµ„ã€æ²™ç›¤éŠæˆ²æ²»ç™‚ Group/Sandplay', hasToyOption: true, toyRentalPrice: 50 },
        { id: 'room-e', name: 'Room E', pricePerHour: 170, facilities: 'å¤§æˆ¿ å®¶åº­æ²»ç™‚ Family Therapy', hasToyOption: false, toyRentalPrice: 0 },
        { id: 'room-f', name: 'Room F', pricePerHour: 150, facilities: 'è½åœ°çª—è¼”å°å®¤ Floor Window', hasToyOption: false, toyRentalPrice: 0 },
        { id: 'room-g', name: 'Room G', pricePerHour: 150, facilities: 'è½åœ°çª—è¼”å°å®¤ Floor Window', hasToyOption: false, toyRentalPrice: 0 }
      ],
      wanchai: [
        { id: 'room-1', name: 'Room 1', pricePerHour: 160, facilities: 'çª—å£å¤§æˆ¿é•·æ²™åŒ– Large/Long Sofa', hasToyOption: false, toyRentalPrice: 0 },
        { id: 'room-2', name: 'Room 2', pricePerHour: 140, facilities: 'èˆ’é©è¼”å°å®¤ Comfortable', hasToyOption: false, toyRentalPrice: 0 },
        { id: 'room-3', name: 'Room 3', pricePerHour: 140, facilities: 'èˆ’é©è¼”å°å®¤ Comfortable', hasToyOption: false, toyRentalPrice: 0 },
        { id: 'room-4', name: 'Room 4', pricePerHour: 180, facilities: 'å°çµ„ã€æ²™ç›¤éŠæˆ²æ²»ç™‚ Group/Sandplay', hasToyOption: true, toyRentalPrice: 40 }
      ],
      tsuenwan: [
        { id: 'room-5', name: 'Room 5', pricePerHour: 130, facilities: 'æ¨™æº–è¼”å°å®¤ Standard', hasToyOption: false, toyRentalPrice: 0 },
        { id: 'room-6', name: 'Room 6', pricePerHour: 140, facilities: 'æ¨™æº–è¼”å°å®¤ Standard', hasToyOption: false, toyRentalPrice: 0 },
        { id: 'room-7', name: 'Room 7', pricePerHour: 140, facilities: 'æ¨™æº–è¼”å°å®¤ Standard', hasToyOption: false, toyRentalPrice: 0 },
        { id: 'room-8', name: 'Room 8', pricePerHour: 160, facilities: 'å¤§çª—è¼”å°å®¤ Large Window', hasToyOption: false, toyRentalPrice: 0 }
      ]
    };
    
    const timeSlots = [];
    for (let h = 9; h < 22; h++) {
      timeSlots.push(`${h.toString().padStart(2, '0')}:00`);
      timeSlots.push(`${h.toString().padStart(2, '0')}:30`);
    }
    timeSlots.push('22:00');
    
    // ============ INITIALIZATION ============
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        
        if (currentUserType === 'renter' && currentUser) {
          updateRenterStats();
          if (selectedRoom) {
            loadTimeSlots();
          }
        } else if (currentUserType === 'staff') {
          renderRenterList();
          renderRoomPricing();
          filterBookings();
          generateReport();
          populateRenterDropdowns();
        }
      }
    };
    
    async function initApp() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            const title = config.system_title || defaultConfig.system_title;
            const titleEl = document.getElementById('systemTitle');
            if (titleEl) titleEl.textContent = title;
          },
          mapToCapabilities: (config) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ['system_title', config.system_title || defaultConfig.system_title]
          ])
        });
      }
      
      const result = await window.dataSdk.init(dataHandler);
      if (!result.isOk) {
        showToast('Failed to initialize åˆå§‹åŒ–å¤±æ•—', 'error');
      }
      
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('bookingDate').value = today;
      
      populateDateSelectors();
    }
    
    function populateDateSelectors() {
      const months = [
        { value: 0, label: 'January ä¸€æœˆ' },
        { value: 1, label: 'February äºŒæœˆ' },
        { value: 2, label: 'March ä¸‰æœˆ' },
        { value: 3, label: 'April å››æœˆ' },
        { value: 4, label: 'May äº”æœˆ' },
        { value: 5, label: 'June å…­æœˆ' },
        { value: 6, label: 'July ä¸ƒæœˆ' },
        { value: 7, label: 'August å…«æœˆ' },
        { value: 8, label: 'September ä¹æœˆ' },
        { value: 9, label: 'October åæœˆ' },
        { value: 10, label: 'November åä¸€æœˆ' },
        { value: 11, label: 'December åäºŒæœˆ' }
      ];
      
      const currentYear = new Date().getFullYear();
      const currentMonth = new Date().getMonth();
      const years = [];
      for (let y = currentYear - 2; y <= currentYear + 1; y++) {
        years.push(y);
      }
      
      const monthSelects = ['statsMonth', 'bookingsFilterMonth', 'reportMonth', 'receiptMonth'];
      const yearSelects = ['statsYear', 'bookingsFilterYear', 'reportYear', 'receiptYear'];
      
      monthSelects.forEach(id => {
        const select = document.getElementById(id);
        if (select) {
          select.innerHTML = months.map(m => 
            `<option value="${m.value}" ${m.value === currentMonth ? 'selected' : ''}>${m.label}</option>`
          ).join('');
        }
      });
      
      yearSelects.forEach(id => {
        const select = document.getElementById(id);
        if (select) {
          select.innerHTML = years.map(y => 
            `<option value="${y}" ${y === currentYear ? 'selected' : ''}>${y}</option>`
          ).join('');
        }
      });
    }
    
    // ============ AUTHENTICATION ============
    function handleLogin() {
      const name = document.getElementById('loginName').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      if (!name || !password) {
        showLoginError('Please enter name and password è«‹è¼¸å…¥å§“åå’Œå¯†ç¢¼');
        return;
      }
      
      const renter = allData.find(d => d.type === 'renter' && d.name === name && d.password === password);
      
      if (renter) {
        currentUser = renter;
        currentUserType = 'renter';
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('renterDashboard').classList.remove('hidden');
        document.getElementById('renterNameDisplay').textContent = name;
        updateRenterStats();
      } else {
        showLoginError('Invalid credentials ç™»å…¥è³‡æ–™ç„¡æ•ˆ');
      }
    }
    
    function showStaffLogin() {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50';
      modal.innerHTML = `
        <div class="bg-white rounded-2xl p-8 max-w-md w-full">
          <h2 class="text-xl font-bold text-gray-800 mb-4">Staff Login å·¥ä½œäººå“¡ç™»å…¥</h2>
          <input type="password" id="staffPasswordInput" placeholder="Enter password è¼¸å…¥å¯†ç¢¼" 
            class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 mb-4">
          <div class="flex space-x-3">
            <button onclick="cancelStaffLogin()" class="flex-1 px-4 py-3 bg-gray-200 hover:bg-gray-300 rounded-xl transition">
              Cancel å–æ¶ˆ
            </button>
            <button onclick="confirmStaffLogin()" class="flex-1 px-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition">
              Login ç™»å…¥
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      document.getElementById('staffPasswordInput').focus();
      
      document.getElementById('staffPasswordInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          confirmStaffLogin();
        }
      });
    }
    
    function cancelStaffLogin() {
      const modal = document.querySelector('.fixed.inset-0');
      if (modal) modal.remove();
    }
    
    function confirmStaffLogin() {
      const password = document.getElementById('staffPasswordInput').value;
      if (password === '123') {
        currentUserType = 'staff';
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('staffDashboard').classList.remove('hidden');
        cancelStaffLogin();
        renderRenterList();
        renderRoomPricing();
        filterBookings();
        generateReport();
        populateRenterDropdowns();
      } else {
        showToast('Invalid staff password å·¥ä½œäººå“¡å¯†ç¢¼ç„¡æ•ˆ', 'error');
      }
    }
    
    function logout() {
      currentUser = null;
      currentUserType = null;
      selectedRoom = null;
      selectedTimeSlots = [];
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('renterDashboard').classList.add('hidden');
      document.getElementById('staffDashboard').classList.add('hidden');
      document.getElementById('loginName').value = '';
      document.getElementById('loginPassword').value = '';
      document.getElementById('loginError').classList.add('hidden');
    }
    
    function showLoginError(msg) {
      const el = document.getElementById('loginError');
      el.textContent = msg;
      el.classList.remove('hidden');
    }
    
    // ============ CONFIRMATION MODAL ============
    function showConfirmModal(message, onConfirm) {
      document.getElementById('confirmMessage').textContent = message;
      document.getElementById('confirmModal').classList.remove('hidden');
      pendingDeleteAction = onConfirm;
    }
    
    function closeConfirmModal() {
      document.getElementById('confirmModal').classList.add('hidden');
      pendingDeleteAction = null;
    }
    
    async function confirmDelete() {
      if (pendingDeleteAction) {
        await pendingDeleteAction();
        pendingDeleteAction = null;
      }
      closeConfirmModal();
    }
    
    // ============ RENTER FUNCTIONS ============
    function getRoomConfig(roomId, branch) {
      const roomConfig = allData.find(d => d.type === 'room_config' && d.roomId === roomId);
      if (roomConfig) {
        return {
          id: roomConfig.roomId,
          name: roomConfig.roomName,
          pricePerHour: roomConfig.pricePerHour,
          facilities: roomConfig.facilities,
          hasToyOption: roomConfig.hasToyOption,
          toyRentalPrice: roomConfig.toyRentalPrice || 0
        };
      }
      const defaults = defaultRooms[branch] || [];
      return defaults.find(r => r.id === roomId) || null;
    }
    
    function updateRoomList() {
      const branch = document.getElementById('branchSelect').value;
      const roomListEl = document.getElementById('roomList');
      
      if (!branch) {
        roomListEl.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">Please select a branch è«‹é¸æ“‡åˆ†åº—</p>';
        document.getElementById('timeSlotSection').classList.add('hidden');
        return;
      }
      
      const branchRooms = defaultRooms[branch] || [];
      
      roomListEl.innerHTML = branchRooms.map(room => {
        const config = getRoomConfig(room.id, branch);
        return `
          <div onclick="selectRoom('${room.id}', '${branch}')" class="cursor-pointer p-4 border-2 border-gray-200 hover:border-indigo-500 rounded-xl transition ${selectedRoom?.id === room.id ? 'border-indigo-500 bg-indigo-50' : ''}">
            <h3 class="font-bold text-gray-800">${config.name}</h3>
            <p class="text-indigo-600 font-semibold">$${config.pricePerHour}/hr</p>
            <p class="text-gray-500 text-sm">${config.facilities}</p>
            ${config.hasToyOption ? `<p class="text-amber-600 text-sm mt-1">ğŸ§¸ +$${config.toyRentalPrice}/hr toy rental</p>` : ''}
          </div>
        `;
      }).join('');
    }
    
    function selectRoom(roomId, branch) {
      const config = getRoomConfig(roomId, branch);
      selectedRoom = { ...config, branch };
      selectedTimeSlots = [];
      document.getElementById('toyRentalCheckbox').checked = false;
      updateRoomList();
      loadTimeSlots();
    }
    
    function loadTimeSlots() {
      if (!selectedRoom) return;
      
      const date = document.getElementById('bookingDate').value;
      if (!date) {
        showToast('Please select a date è«‹é¸æ“‡æ—¥æœŸ', 'warning');
        return;
      }
      
      document.getElementById('timeSlotSection').classList.remove('hidden');
      document.getElementById('selectedRoomInfo').textContent = 
        `${selectedRoom.name} - $${selectedRoom.pricePerHour}/hr - ${selectedRoom.facilities}`;
      
      const toyOption = document.getElementById('toyRentalOption');
      if (selectedRoom.hasToyOption) {
        toyOption.classList.remove('hidden');
        document.getElementById('toyPriceDisplay').textContent = ` (+$${selectedRoom.toyRentalPrice}/hr)`;
      } else {
        toyOption.classList.add('hidden');
      }
      
      const bookedSlots = allData
        .filter(d => d.type === 'booking' && d.roomId === selectedRoom.id && d.date === date)
        .map(b => b.startTime);
      
      const startSelect = document.getElementById('startTimeSelect');
      startSelect.innerHTML = '<option value="">Select start time é¸æ“‡é–‹å§‹æ™‚é–“</option>' + 
        timeSlots.slice(0, -1).map(slot => {
          const isBooked = bookedSlots.includes(slot);
          return `<option value="${slot}" ${isBooked ? 'disabled style="color: #999; background: #f3f4f6;"' : ''}>${slot}${isBooked ? ' (å·²é ç´„ Booked)' : ''}</option>`;
        }).join('');
      
      document.getElementById('endTimeSelect').innerHTML = '<option value="">Select end time é¸æ“‡çµæŸæ™‚é–“</option>';
      document.getElementById('startTimeSelect').value = '';
      document.getElementById('endTimeSelect').value = '';
      
      updatePriceDisplay();
    }
    
    function updateEndTimeOptions() {
      const startTime = document.getElementById('startTimeSelect').value;
      const endSelect = document.getElementById('endTimeSelect');
      
      if (!startTime) {
        endSelect.innerHTML = '<option value="">Select end time é¸æ“‡çµæŸæ™‚é–“</option>';
        updatePriceDisplay();
        return;
      }
      
      const date = document.getElementById('bookingDate').value;
      const bookedSlots = allData
        .filter(d => d.type === 'booking' && d.roomId === selectedRoom.id && d.date === date)
        .map(b => b.startTime);
      
      const startIdx = timeSlots.indexOf(startTime);
      const availableEndTimes = [];
      
      for (let i = startIdx + 1; i < timeSlots.length; i++) {
        const checkSlot = timeSlots[i - 1];
        if (bookedSlots.includes(checkSlot)) {
          break;
        }
        availableEndTimes.push(timeSlots[i]);
      }
      
      endSelect.innerHTML = '<option value="">Select end time é¸æ“‡çµæŸæ™‚é–“</option>' +
        availableEndTimes.map(time => 
          `<option value="${time}">${time}</option>`
        ).join('');
      
      updatePriceDisplay();
    }
    
    function updatePriceDisplay() {
      const startTime = document.getElementById('startTimeSelect').value;
      const endTime = document.getElementById('endTimeSelect').value;
      
      if (!startTime || !endTime) {
        document.getElementById('durationDisplay').textContent = '0';
        document.getElementById('totalPriceDisplay').textContent = '$0';
        document.getElementById('confirmBookingBtn').disabled = true;
        document.getElementById('bookedSlotsWarning').classList.add('hidden');
        return;
      }
      
      const startIdx = timeSlots.indexOf(startTime);
      const endIdx = timeSlots.indexOf(endTime);
      const duration = (endIdx - startIdx) * 0.5;
      
      const toyRental = document.getElementById('toyRentalCheckbox').checked;
      const basePrice = selectedRoom ? selectedRoom.pricePerHour : 0;
      const toyPrice = (toyRental && selectedRoom?.hasToyOption) ? selectedRoom.toyRentalPrice : 0;
      const total = duration * (basePrice + toyPrice);
      
      document.getElementById('durationDisplay').textContent = duration;
      document.getElementById('totalPriceDisplay').textContent = `$${total}`;
      document.getElementById('confirmBookingBtn').disabled = false;
      
      const date = document.getElementById('bookingDate').value;
      const bookedSlots = allData
        .filter(d => d.type === 'booking' && d.roomId === selectedRoom.id && d.date === date)
        .map(b => b.startTime);
      
      const slotsInRange = [];
      for (let i = startIdx; i < endIdx; i++) {
        slotsInRange.push(timeSlots[i]);
      }
      
      const conflictingSlots = slotsInRange.filter(s => bookedSlots.includes(s));
      if (conflictingSlots.length > 0) {
        document.getElementById('bookedSlotsWarning').classList.remove('hidden');
        document.getElementById('bookedTimesList').textContent = conflictingSlots.join(', ');
        document.getElementById('confirmBookingBtn').disabled = true;
      } else {
        document.getElementById('bookedSlotsWarning').classList.add('hidden');
      }
    }
    
    async function confirmBooking() {
      if (!selectedRoom || !currentUser) return;
      
      const startTime = document.getElementById('startTimeSelect').value;
      const endTime = document.getElementById('endTimeSelect').value;
      
      if (!startTime || !endTime) {
        showToast('Please select start and end time è«‹é¸æ“‡é–‹å§‹å’ŒçµæŸæ™‚é–“', 'warning');
        return;
      }
      
      const date = document.getElementById('bookingDate').value;
      const toyRental = document.getElementById('toyRentalCheckbox').checked && selectedRoom.hasToyOption;
      const toyPrice = toyRental ? selectedRoom.toyRentalPrice : 0;
      
      document.getElementById('confirmBookingBtn').disabled = true;
      document.getElementById('confirmBookingBtn').textContent = 'Booking... é ç´„ä¸­...';
      
      const startIdx = timeSlots.indexOf(startTime);
      const endIdx = timeSlots.indexOf(endTime);
      const slotsToBook = [];
      
      for (let i = startIdx; i < endIdx; i++) {
        slotsToBook.push(timeSlots[i]);
      }
      
      let successCount = 0;
      for (const slot of slotsToBook) {
        const slotEndHour = parseInt(slot.split(':')[0]);
        const slotEndMin = parseInt(slot.split(':')[1]) + 30;
        const slotEndTime = slotEndMin >= 60 
          ? `${(slotEndHour + 1).toString().padStart(2, '0')}:00`
          : `${slotEndHour.toString().padStart(2, '0')}:30`;
        
        const booking = {
          type: 'booking',
          roomId: selectedRoom.id,
          roomName: selectedRoom.name,
          branch: selectedRoom.branch,
          date: date,
          startTime: slot,
          endTime: slotEndTime,
          renterId: currentUser.__backendId,
          renterName: currentUser.name,
          basePrice: selectedRoom.pricePerHour / 2,
          toyRental: toyRental,
          toyPrice: toyRental ? toyPrice / 2 : 0,
          totalPrice: (selectedRoom.pricePerHour + toyPrice) / 2,
          createdAt: new Date().toISOString()
        };
        
        const result = await window.dataSdk.create(booking);
        if (result.isOk) successCount++;
      }
      
      if (successCount > 0) {
        showToast(`Booked ${startTime} to ${endTime} successfully æˆåŠŸé ç´„ ${startTime} è‡³ ${endTime}`, 'success');
        document.getElementById('startTimeSelect').value = '';
        document.getElementById('endTimeSelect').value = '';
        loadTimeSlots();
      } else {
        showToast('Booking failed é ç´„å¤±æ•—', 'error');
      }
      
      document.getElementById('confirmBookingBtn').disabled = false;
      document.getElementById('confirmBookingBtn').textContent = 'Confirm Booking ç¢ºèªé ç´„';
    }
    
    function updateRenterStats() {
      if (!currentUser) return;
      
      const month = parseInt(document.getElementById('statsMonth').value);
      const year = parseInt(document.getElementById('statsYear').value);
      
      const bookings = allData.filter(d => {
        if (d.type !== 'booking' || d.renterId !== currentUser.__backendId) return false;
        const bookingDate = new Date(d.date);
        return bookingDate.getMonth() === month && bookingDate.getFullYear() === year;
      });
      
      const totalHours = bookings.length * 0.5;
      const totalAmount = bookings.reduce((sum, b) => sum + (b.totalPrice || 0), 0);
      
      document.getElementById('statsTotalHours').textContent = totalHours;
      document.getElementById('statsTotalBookings').textContent = bookings.length;
      document.getElementById('statsTotalAmount').textContent = `$${totalAmount}`;
      
      const listEl = document.getElementById('renterBookingsList');
      if (bookings.length === 0) {
        listEl.innerHTML = '<p class="text-gray-500 text-center py-4">No bookings this month æœ¬æœˆæ²’æœ‰é ç´„</p>';
        return;
      }
      
      bookings.sort((a, b) => {
        const dateCompare = a.date.localeCompare(b.date);
        if (dateCompare !== 0) return dateCompare;
        if (a.roomId !== b.roomId) return a.roomId.localeCompare(b.roomId);
        return a.startTime.localeCompare(b.startTime);
      });
      
      const mergedBookings = [];
      let current = null;
      
      bookings.forEach(b => {
        if (!current) {
          current = {
            date: b.date,
            roomId: b.roomId,
            roomName: b.roomName,
            branch: b.branch,
            startTime: b.startTime,
            endTime: b.endTime,
            toyRental: b.toyRental,
            totalPrice: b.totalPrice,
            bookingIds: [b.__backendId]
          };
        } else if (
          current.date === b.date &&
          current.roomId === b.roomId &&
          current.endTime === b.startTime &&
          current.toyRental === b.toyRental
        ) {
          current.endTime = b.endTime;
          current.totalPrice += b.totalPrice;
          current.bookingIds.push(b.__backendId);
        } else {
          mergedBookings.push(current);
          current = {
            date: b.date,
            roomId: b.roomId,
            roomName: b.roomName,
            branch: b.branch,
            startTime: b.startTime,
            endTime: b.endTime,
            toyRental: b.toyRental,
            totalPrice: b.totalPrice,
            bookingIds: [b.__backendId]
          };
        }
      });
      
      if (current) {
        mergedBookings.push(current);
      }
      
      const grouped = {};
      mergedBookings.forEach(b => {
        if (!grouped[b.date]) grouped[b.date] = [];
        grouped[b.date].push(b);
      });
      
      listEl.innerHTML = Object.entries(grouped)
        .sort((a, b) => a[0].localeCompare(b[0]))
        .map(([date, items]) => `
          <div class="border border-gray-200 rounded-lg p-3">
            <div class="font-semibold text-gray-800 mb-2">${formatDate(date)}</div>
            ${items.map(b => `
              <div class="flex justify-between items-center text-sm text-gray-600 py-1 border-t border-gray-100 gap-2">
                <span class="flex-1">${b.roomName} (${getBranchName(b.branch)})</span>
                <span>${b.startTime} - ${b.endTime}</span>
                <span class="font-medium">$${b.totalPrice}${b.toyRental ? ' ğŸ§¸' : ''}</span>
                <button onclick="cancelMergedBooking('${b.bookingIds.join(',')}', '${b.roomName}', '${b.startTime}', '${b.endTime}')" class="px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded text-xs transition">
                  âœ•
                </button>
              </div>
            `).join('')}
          </div>
        `).join('');
    }
    
    function cancelMergedBooking(bookingIds, roomName, startTime, endTime) {
      const ids = bookingIds.split(',');
      const message = `Cancel booking for ${roomName} from ${startTime} to ${endTime}?\nå–æ¶ˆ ${roomName} ${startTime} è‡³ ${endTime} çš„é ç´„?`;
      
      showConfirmModal(message, async () => {
        let successCount = 0;
        for (const id of ids) {
          const booking = allData.find(d => d.__backendId === id);
          if (booking) {
            const result = await window.dataSdk.delete(booking);
            if (result.isOk) successCount++;
          }
        }
        
        if (successCount > 0) {
          showToast(`Cancelled ${successCount} booking slots å·²å–æ¶ˆ ${successCount} å€‹æ™‚æ®µ`, 'success');
        } else {
          showToast('Failed to cancel booking å–æ¶ˆå¤±æ•—', 'error');
        }
      });
    }
    
    // ============ STAFF FUNCTIONS ============
    function showStaffTab(tab) {
      document.querySelectorAll('.staff-tab').forEach(btn => {
        btn.classList.remove('bg-indigo-600', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700');
      });
      document.querySelector(`[data-tab="${tab}"]`).classList.remove('bg-gray-200', 'text-gray-700');
      document.querySelector(`[data-tab="${tab}"]`).classList.add('bg-indigo-600', 'text-white');
      
      document.querySelectorAll('.staff-tab-content').forEach(el => el.classList.add('hidden'));
      document.getElementById(`staff${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`).classList.remove('hidden');
    }
    
    async function addNewRenter() {
      const name = document.getElementById('newRenterName').value.trim();
      const password = document.getElementById('newRenterPassword').value;
      const email = document.getElementById('newRenterEmail').value.trim();
      const phone = document.getElementById('newRenterPhone').value.trim();
      
      if (!name || !password) {
        showToast('Name and password required éœ€è¦å§“åå’Œå¯†ç¢¼', 'warning');
        return;
      }
      
      const existing = allData.find(d => d.type === 'renter' && d.name === name);
      if (existing) {
        showToast('Renter name already exists ç§Ÿç”¨è€…åç¨±å·²å­˜åœ¨', 'error');
        return;
      }
      
      const result = await window.dataSdk.create({
        type: 'renter',
        name: name,
        password: password,
        email: email,
        phone: phone,
        createdAt: new Date().toISOString()
      });
      
      if (result.isOk) {
        showToast('Renter added å·²æ–°å¢ç§Ÿç”¨è€…', 'success');
        document.getElementById('newRenterName').value = '';
        document.getElementById('newRenterPassword').value = '';
        document.getElementById('newRenterEmail').value = '';
        document.getElementById('newRenterPhone').value = '';
      } else {
        showToast('Failed to add renter æ–°å¢ç§Ÿç”¨è€…å¤±æ•—', 'error');
      }
    }
    
    function renderRenterList() {
      const renters = allData.filter(d => d.type === 'renter');
      const listEl = document.getElementById('renterList');
      
      if (renters.length === 0) {
        listEl.innerHTML = '<p class="text-gray-500 text-center py-4">No renters yet å°šç„¡ç§Ÿç”¨è€…</p>';
        return;
      }
      
      listEl.innerHTML = renters.map(r => `
        <div class="border border-gray-200 rounded-lg p-4 flex flex-wrap justify-between items-center gap-4">
          <div class="flex-1 min-w-0">
            <h3 class="font-bold text-gray-800">${r.name}</h3>
            <p class="text-sm text-gray-500">${r.email || 'No email'} | ${r.phone || 'No phone'}</p>
            <p class="text-sm text-indigo-600">Password å¯†ç¢¼: ${r.password}</p>
          </div>
          <div class="flex space-x-2">
            <button onclick="editRenter('${r.__backendId}')" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm transition">
              Edit ç·¨è¼¯
            </button>
            <button onclick="deleteRenter('${r.__backendId}', '${r.name}')" class="px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg text-sm transition">
              Delete åˆªé™¤
            </button>
          </div>
        </div>
      `).join('');
    }
    
    async function editRenter(id) {
      const renter = allData.find(d => d.__backendId === id);
      if (!renter) return;
      
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50';
      modal.innerHTML = `
        <div class="bg-white rounded-2xl p-8 max-w-md w-full">
          <h2 class="text-xl font-bold text-gray-800 mb-4">Edit Renter ç·¨è¼¯ç§Ÿç”¨è€…</h2>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Name å§“å</label>
              <input type="text" id="editRenterName" value="${renter.name}" class="w-full px-4 py-3 border border-gray-200 rounded-xl">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Password å¯†ç¢¼</label>
              <input type="text" id="editRenterPassword" value="${renter.password}" class="w-full px-4 py-3 border border-gray-200 rounded-xl">
            </div>
          </div>
          <div class="flex space-x-3 mt-6">
            <button onclick="closeEditRenterModal()" class="flex-1 px-4 py-3 bg-gray-200 hover:bg-gray-300 rounded-xl transition">
              Cancel å–æ¶ˆ
            </button>
            <button onclick="saveRenterEdit('${id}')" class="flex-1 px-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition">
              Save å„²å­˜
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      modal.id = 'editRenterModal';
    }
    
    function closeEditRenterModal() {
      const modal = document.getElementById('editRenterModal');
      if (modal) modal.remove();
    }
    
    async function saveRenterEdit(id) {
      const renter = allData.find(d => d.__backendId === id);
      if (!renter) return;
      
      const newName = document.getElementById('editRenterName').value.trim();
      const newPassword = document.getElementById('editRenterPassword').value;
      
      if (!newName || !newPassword) {
        showToast('Name and password required éœ€è¦å§“åå’Œå¯†ç¢¼', 'warning');
        return;
      }
      
      const result = await window.dataSdk.update({
        ...renter,
        name: newName,
        password: newPassword
      });
      
      if (result.isOk) {
        showToast('Renter updated ç§Ÿç”¨è€…å·²æ›´æ–°', 'success');
        closeEditRenterModal();
      } else {
        showToast('Failed to update renter æ›´æ–°å¤±æ•—', 'error');
      }
    }
    
    function deleteRenter(id, name) {
      const renter = allData.find(d => d.__backendId === id);
      if (!renter) return;
      
      showConfirmModal(`Delete ${name}? åˆªé™¤ ${name}?`, async () => {
        const result = await window.dataSdk.delete(renter);
        if (result.isOk) {
          showToast('Renter deleted ç§Ÿç”¨è€…å·²åˆªé™¤', 'success');
        } else {
          showToast('Failed to delete renter åˆªé™¤å¤±æ•—', 'error');
        }
      });
    }
    
    function renderRoomPricing() {
      ['jordan', 'wanchai', 'tsuenwan'].forEach(branch => {
        const rooms = defaultRooms[branch] || [];
        const containerEl = document.getElementById(`${branch}Rooms`);
        
        containerEl.innerHTML = rooms.map(room => {
          const config = getRoomConfig(room.id, branch);
          return `
            <div class="border border-gray-200 rounded-lg p-4">
              <h4 class="font-semibold text-gray-800">${config.name}</h4>
              <p class="text-sm text-gray-500 mb-2">${config.facilities}</p>
              <div class="flex items-center space-x-2 mb-2">
                <label class="text-sm text-gray-600">Price ç§Ÿé‡‘:</label>
                <input type="number" value="${config.pricePerHour}" 
                  onchange="updateRoomPrice('${room.id}', '${room.name}', '${branch}', this.value, '${config.facilities}', ${config.hasToyOption}, ${config.toyRentalPrice})"
                  class="w-24 px-2 py-1 border border-gray-200 rounded-lg text-center">
                <span class="text-sm text-gray-500">/hr</span>
              </div>
              ${config.hasToyOption ? `
                <div class="flex items-center space-x-2">
                  <label class="text-sm text-gray-600">Toy ç©å…·:</label>
                  <input type="number" value="${config.toyRentalPrice}" 
                    onchange="updateRoomPrice('${room.id}', '${room.name}', '${branch}', ${config.pricePerHour}, '${config.facilities}', true, this.value)"
                    class="w-24 px-2 py-1 border border-gray-200 rounded-lg text-center">
                  <span class="text-sm text-gray-500">/hr</span>
                </div>
              ` : ''}
            </div>
          `;
        }).join('');
      });
    }
    
    async function updateRoomPrice(roomId, roomName, branch, price, facilities, hasToyOption, toyPrice) {
      const existing = allData.find(d => d.type === 'room_config' && d.roomId === roomId);
      
      const roomConfig = {
        type: 'room_config',
        roomId: roomId,
        roomName: roomName,
        branch: branch,
        pricePerHour: parseInt(price),
        facilities: facilities,
        hasToyOption: hasToyOption,
        toyRentalPrice: parseInt(toyPrice) || 0,
        updatedAt: new Date().toISOString()
      };
      
      let result;
      if (existing) {
        result = await window.dataSdk.update({ ...existing, ...roomConfig });
      } else {
        result = await window.dataSdk.create(roomConfig);
      }
      
      if (result.isOk) {
        showToast('Room price updated æˆ¿é–“åƒ¹æ ¼å·²æ›´æ–°', 'success');
      }
    }
    
    function filterBookings() {
      const month = parseInt(document.getElementById('bookingsFilterMonth').value);
      const year = parseInt(document.getElementById('bookingsFilterYear').value);
      const renterFilter = document.getElementById('bookingsFilterRenter').value;
      
      let bookings = allData.filter(d => {
        if (d.type !== 'booking') return false;
        const bookingDate = new Date(d.date);
        if (bookingDate.getMonth() !== month || bookingDate.getFullYear() !== year) return false;
        if (renterFilter && d.renterId !== renterFilter) return false;
        return true;
      });
      
      bookings.sort((a, b) => {
        const dateCompare = a.date.localeCompare(b.date);
        if (dateCompare !== 0) return dateCompare;
        return a.startTime.localeCompare(b.startTime);
      });
      
      const listEl = document.getElementById('allBookingsList');
      
      if (bookings.length === 0) {
        listEl.innerHTML = '<p class="text-gray-500 text-center py-4">No bookings found æ²’æœ‰æ‰¾åˆ°é ç´„</p>';
        return;
      }
      
      listEl.innerHTML = bookings.map(b => `
        <div class="border border-gray-200 rounded-lg p-3 flex flex-wrap justify-between items-center gap-2">
          <div class="flex-1 min-w-0">
            <div class="font-semibold text-gray-800">${b.renterName}</div>
            <div class="text-sm text-gray-500">${formatDate(b.date)} | ${b.startTime} - ${b.endTime}</div>
          </div>
          <div class="text-center">
            <div class="font-medium text-gray-800">${b.roomName}</div>
            <div class="text-sm text-gray-500">${getBranchName(b.branch)}</div>
          </div>
          <div class="text-right">
            <div class="font-bold text-indigo-600">$${b.totalPrice}</div>
            ${b.toyRental ? '<div class="text-xs text-amber-600">ğŸ§¸ Toy</div>' : ''}
          </div>
          <button onclick="deleteBookingStaff('${b.__backendId}', '${b.renterName}', '${b.roomName}', '${formatDate(b.date)}', '${b.startTime}')" class="px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded text-sm transition">
            âœ•
          </button>
        </div>
      `).join('');
    }
    
    function deleteBookingStaff(id, renterName, roomName, date, time) {
      const booking = allData.find(d => d.__backendId === id);
      if (!booking) return;
      
      showConfirmModal(`Delete booking for ${renterName}?\n${roomName} on ${date} at ${time}\n\nåˆªé™¤ ${renterName} çš„é ç´„ï¼Ÿ\n${roomName} ${date} ${time}`, async () => {
        const result = await window.dataSdk.delete(booking);
        if (result.isOk) {
          showToast('Booking deleted é ç´„å·²åˆªé™¤', 'success');
        } else {
          showToast('Failed to delete booking åˆªé™¤å¤±æ•—', 'error');
        }
      });
    }
    
    function populateRenterDropdowns() {
      const renters = allData.filter(d => d.type === 'renter');
      const options = '<option value="">All Renters æ‰€æœ‰ç§Ÿç”¨è€…</option>' + 
        renters.map(r => `<option value="${r.__backendId}">${r.name}</option>`).join('');
      
      document.getElementById('bookingsFilterRenter').innerHTML = options;
      
      const receiptOptions = '<option value="">Select Renter é¸æ“‡ç§Ÿç”¨è€…</option>' + 
        renters.map(r => `<option value="${r.__backendId}">${r.name}</option>`).join('');
      document.getElementById('receiptRenter').innerHTML = receiptOptions;
    }
    
    function generateReport() {
      const month = parseInt(document.getElementById('reportMonth').value);
      const year = parseInt(document.getElementById('reportYear').value);
      
      const bookings = allData.filter(d => {
        if (d.type !== 'booking') return false;
        const bookingDate = new Date(d.date);
        return bookingDate.getMonth() === month && bookingDate.getFullYear() === year;
      });
      
      const totalRevenue = bookings.reduce((sum, b) => sum + (b.totalPrice || 0), 0);
      const totalHours = bookings.length * 0.5;
      
      const byRenter = {};
      bookings.forEach(b => {
        if (!byRenter[b.renterId]) {
          byRenter[b.renterId] = { name: b.renterName, bookings: [], total: 0 };
        }
        byRenter[b.renterId].bookings.push(b);
        byRenter[b.renterId].total += b.totalPrice || 0;
      });
      
      const byRoom = {};
      bookings.forEach(b => {
        const key = `${b.branch}-${b.roomId}`;
        if (!byRoom[key]) {
          byRoom[key] = { name: b.roomName, branch: b.branch, count: 0, total: 0 };
        }
        byRoom[key].count++;
        byRoom[key].total += b.totalPrice || 0;
      });
      
      const monthNames = ['January ä¸€æœˆ', 'February äºŒæœˆ', 'March ä¸‰æœˆ', 'April å››æœˆ', 'May äº”æœˆ', 'June å…­æœˆ', 
        'July ä¸ƒæœˆ', 'August å…«æœˆ', 'September ä¹æœˆ', 'October åæœˆ', 'November åä¸€æœˆ', 'December åäºŒæœˆ'];
      
      document.getElementById('reportPeriod').textContent = `${monthNames[month]} ${year}`;
      document.getElementById('reportTotalRevenue').textContent = `$${totalRevenue}`;
      document.getElementById('reportTotalBookings').textContent = bookings.length;
      document.getElementById('reportTotalHours').textContent = totalHours;
      document.getElementById('reportActiveRenters').textContent = Object.keys(byRenter).length;
      
      document.getElementById('reportByRenter').innerHTML = Object.values(byRenter).map(r => `
        <div class="border border-gray-200 rounded-lg p-4">
          <div class="flex justify-between items-center mb-2">
            <h4 class="font-bold text-gray-800">${r.name}</h4>
            <span class="text-lg font-bold text-indigo-600">$${r.total}</span>
          </div>
          <div class="text-sm text-gray-600">
            ${r.bookings.length} bookings é ç´„ | ${r.bookings.length * 0.5} hours å°æ™‚
          </div>
        </div>
      `).join('');
      
      document.getElementById('reportByRoom').innerHTML = Object.values(byRoom).map(r => `
        <div class="flex justify-between items-center border-b border-gray-100 py-2">
          <span class="text-gray-800">${r.name} (${getBranchName(r.branch)})</span>
          <span class="text-gray-600">${r.count} slots | ${r.count * 0.5}hrs</span>
          <span class="font-medium text-indigo-600">$${r.total}</span>
        </div>
      `).join('');
    }
    
    function generateReceipt() {
      const renterId = document.getElementById('receiptRenter').value;
      const month = parseInt(document.getElementById('receiptMonth').value);
      const year = parseInt(document.getElementById('receiptYear').value);
      
      if (!renterId) {
        showToast('Please select a renter è«‹é¸æ“‡ç§Ÿç”¨è€…', 'warning');
        return;
      }
      
      const renter = allData.find(d => d.__backendId === renterId);
      if (!renter) return;
      
      const bookings = allData.filter(d => {
        if (d.type !== 'booking' || d.renterId !== renterId) return false;
        const bookingDate = new Date(d.date);
        return bookingDate.getMonth() === month && bookingDate.getFullYear() === year;
      });
      
      const total = bookings.reduce((sum, b) => sum + (b.totalPrice || 0), 0);
      
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
        'July', 'August', 'September', 'October', 'November', 'December'];
      
      document.getElementById('receiptContent').innerHTML = `
        <div class="text-center mb-6">
          <h1 class="text-2xl font-bold text-gray-800">Room Rental Receipt</h1>
          <h2 class="text-xl text-gray-600">æˆ¿é–“ç§Ÿç”¨æ”¶æ“š</h2>
          <p class="text-gray-500 mt-2">${monthNames[month]} ${year}</p>
        </div>
        
        <div class="border-b border-gray-200 pb-4 mb-4">
          <h3 class="font-semibold text-gray-700">Renter ç§Ÿç”¨è€…: ${renter.name}</h3>
          <p class="text-gray-500">${renter.email || ''} ${renter.phone || ''}</p>
        </div>
        
        <table class="w-full text-sm mb-6">
          <thead>
            <tr class="border-b border-gray-200">
              <th class="text-left py-2">Date æ—¥æœŸ</th>
              <th class="text-left py-2">Room æˆ¿é–“</th>
              <th class="text-left py-2">Time æ™‚é–“</th>
              <th class="text-right py-2">Amount é‡‘é¡</th>
            </tr>
          </thead>
          <tbody>
            ${bookings.map(b => `
              <tr class="border-b border-gray-100">
                <td class="py-2">${formatDate(b.date)}</td>
                <td class="py-2">${b.roomName}</td>
                <td class="py-2">${b.startTime}-${b.endTime}${b.toyRental ? ' ğŸ§¸' : ''}</td>
                <td class="py-2 text-right">$${b.totalPrice}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
        
        <div class="flex justify-between items-center text-xl font-bold border-t border-gray-300 pt-4">
          <span>Total ç¸½è¨ˆ:</span>
          <span class="text-indigo-600">$${total}</span>
        </div>
        
        <div class="text-center mt-8 text-gray-500 text-sm">
          <p>Generated on ç”Ÿæˆæ—¥æœŸ: ${new Date().toLocaleDateString()}</p>
        </div>
      `;
      
      document.getElementById('receiptModal').classList.remove('hidden');
    }
    
    function closeReceiptModal() {
      document.getElementById('receiptModal').classList.add('hidden');
    }
    
    function printReceipt() {
      const renterId = document.getElementById('receiptRenter').value;
      const month = parseInt(document.getElementById('receiptMonth').value);
      const year = parseInt(document.getElementById('receiptYear').value);
      
      const renter = allData.find(d => d.__backendId === renterId);
      if (!renter) return;
      
      const bookings = allData.filter(d => {
        if (d.type !== 'booking' || d.renterId !== renterId) return false;
        const bookingDate = new Date(d.date);
        return bookingDate.getMonth() === month && bookingDate.getFullYear() === year;
      });
      
      const total = bookings.reduce((sum, b) => sum + (b.totalPrice || 0), 0);
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
        'July', 'August', 'September', 'October', 'November', 'December'];
      
      let csvContent = '\uFEFF';
      csvContent += `Room Rental Receipt\n`;
      csvContent += `Period: ${monthNames[month]} ${year}\n`;
      csvContent += `Renter: ${renter.name}\n`;
      csvContent += `Contact: ${renter.email || ''} ${renter.phone || ''}\n\n`;
      csvContent += `Date,Room,Start Time,End Time,Amount,Toy Rental\n`;
      
      bookings.forEach(b => {
        csvContent += `${b.date},${b.roomName},${b.startTime},${b.endTime},$${b.totalPrice},${b.toyRental ? 'Yes' : 'No'}\n`;
      });
      
      csvContent += `\nTotal,$${total}\n`;
      csvContent += `\nGenerated on,${new Date().toLocaleDateString()}\n`;
      
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', `Receipt_${renter.name}_${monthNames[month]}_${year}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      
      showToast('Receipt downloaded æ”¶æ“šå·²ä¸‹è¼‰', 'success');
      closeReceiptModal();
    }
    
    // ============ UTILITIES ============
    function downloadRenterReport() {
      if (!currentUser) return;
      
      const month = parseInt(document.getElementById('statsMonth').value);
      const year = parseInt(document.getElementById('statsYear').value);
      
      const bookings = allData.filter(d => {
        if (d.type !== 'booking' || d.renterId !== currentUser.__backendId) return false;
        const bookingDate = new Date(d.date);
        return bookingDate.getMonth() === month && bookingDate.getFullYear() === year;
      });
      
      const totalAmount = bookings.reduce((sum, b) => sum + (b.totalPrice || 0), 0);
      const totalHours = bookings.length * 0.5;
      
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
        'July', 'August', 'September', 'October', 'November', 'December'];
      
      let csvContent = '\uFEFF';
      csvContent += `Rental Report for ${currentUser.name}\n`;
      csvContent += `Period: ${monthNames[month]} ${year}\n`;
      csvContent += `Total Bookings: ${bookings.length}\n`;
      csvContent += `Total Hours: ${totalHours}\n`;
      csvContent += `Total Amount: $${totalAmount}\n\n`;
      csvContent += `Date,Room,Branch,Start Time,End Time,Price,Toy Rental\n`;
      
      bookings.sort((a, b) => {
        const dateCompare = a.date.localeCompare(b.date);
        if (dateCompare !== 0) return dateCompare;
        return a.startTime.localeCompare(b.startTime);
      });
      
      bookings.forEach(b => {
        csvContent += `${b.date},${b.roomName},${getBranchName(b.branch)},${b.startTime},${b.endTime},$${b.totalPrice},${b.toyRental ? 'Yes' : 'No'}\n`;
      });
      
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', `${currentUser.name}_${monthNames[month]}_${year}_Report.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      
      showToast('Report downloaded å ±è¡¨å·²ä¸‹è¼‰', 'success');
    }
    
    function downloadAllBookings() {
      const month = parseInt(document.getElementById('bookingsFilterMonth').value);
      const year = parseInt(document.getElementById('bookingsFilterYear').value);
      const renterFilter = document.getElementById('bookingsFilterRenter').value;
      
      let bookings = allData.filter(d => {
        if (d.type !== 'booking') return false;
        const bookingDate = new Date(d.date);
        if (bookingDate.getMonth() !== month || bookingDate.getFullYear() !== year) return false;
        if (renterFilter && d.renterId !== renterFilter) return false;
        return true;
      });
      
      bookings.sort((a, b) => {
        const dateCompare = a.date.localeCompare(b.date);
        if (dateCompare !== 0) return dateCompare;
        return a.startTime.localeCompare(b.startTime);
      });
      
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
        'July', 'August', 'September', 'October', 'November', 'December'];
      
      const totalAmount = bookings.reduce((sum, b) => sum + (b.totalPrice || 0), 0);
      const totalHours = bookings.length * 0.5;
      
      let csvContent = '\uFEFF';
      csvContent += `All Bookings Report\n`;
      csvContent += `Period: ${monthNames[month]} ${year}\n`;
      if (renterFilter) {
        const renter = allData.find(d => d.__backendId === renterFilter);
        csvContent += `Renter: ${renter ? renter.name : 'Unknown'}\n`;
      }
      csvContent += `Total Bookings: ${bookings.length}\n`;
      csvContent += `Total Hours: ${totalHours}\n`;
      csvContent += `Total Amount: $${totalAmount}\n\n`;
      csvContent += `Date,Renter,Room,Branch,Start Time,End Time,Price,Toy Rental\n`;
      
      bookings.forEach(b => {
        csvContent += `${b.date},${b.renterName},${b.roomName},${getBranchName(b.branch)},${b.startTime},${b.endTime},$${b.totalPrice},${b.toyRental ? 'Yes' : 'No'}\n`;
      });
      
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      const filterText = renterFilter ? `_${allData.find(d => d.__backendId === renterFilter)?.name || 'Filtered'}` : '_All';
      link.setAttribute('download', `Bookings_${monthNames[month]}_${year}${filterText}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      
      showToast('Bookings downloaded é ç´„ç´€éŒ„å·²ä¸‹è¼‰', 'success');
    }
    
    function getBranchName(branch) {
      const names = {
        jordan: 'ä½æ•¦ Jordan',
        wanchai: 'ç£ä»” Wan Chai',
        tsuenwan: 'èƒç£ Tsuen Wan'
      };
      return names[branch] || branch;
    }
    
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('zh-HK', { year: 'numeric', month: 'short', day: 'numeric' });
    }
    
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      const colors = {
        success: 'bg-green-500 text-white',
        error: 'bg-red-500 text-white',
        warning: 'bg-amber-500 text-white',
        info: 'bg-indigo-500 text-white'
      };
      
      toast.className = `fixed bottom-4 right-4 px-6 py-4 rounded-xl shadow-lg z-50 transition-all transform ${colors[type] || colors.info}`;
      toast.textContent = message;
      toast.classList.remove('hidden', 'translate-y-full');
      
      setTimeout(() => {
        toast.classList.add('translate-y-full');
        setTimeout(() => toast.classList.add('hidden'), 300);
      }, 3000);
    }
    
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cbc2386d020cb25',t:'MTc3MDczMjA5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
