<!DOCTYPE html>
<html lang="zh-Hant" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心理輔導室預約系統 | Oma Room Booking System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #1e40af;
            --accent-color: #8b5cf6;
            --light-bg: #f8fafc;
        }
        
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: var(--light-bg);
        }
        
        .chinese-font {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .english-font {
            font-family: 'Inter', sans-serif;
        }
        
        .bilingual-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .bilingual-text .english {
            font-family: 'Inter', sans-serif;
            font-size: 0.95em;
        }
        
        .bilingual-text .chinese {
            font-family: 'Noto Sans TC', sans-serif;
            font-size: 0.85em;
            color: #666;
        }
        
        .bilingual-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        
        .bilingual-label .english {
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }
        
        .bilingual-label .chinese {
            font-family: 'Noto Sans TC', sans-serif;
            color: #666;
            font-size: 0.9em;
        }
        
        .print-header, .print-footer {
            display: none;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block !important;
            }
            
            .print-header, .print-footer {
                display: block;
            }
            
            body {
                background: white !important;
                font-size: 12pt;
            }
            
            .print-page-break {
                page-break-before: always;
            }
            
            .print-border {
                border: 1px solid #ddd !important;
            }
        }
        
        .slot-booked {
            background-color: #f3f4f6 !important;
            color: #9ca3af !important;
            cursor: not-allowed !important;
            text-decoration: line-through;
        }
        
        .slot-selected {
            background-color: #3b82f6 !important;
            color: white !important;
            font-weight: 600;
        }
        
        .slot-available {
            background-color: #dbeafe !important;
            color: #1e40af !important;
            cursor: pointer;
        }
        
        .slot-available:hover {
            background-color: #bfdbfe !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .slot-past {
            background-color: #f9fafb !important;
            color: #d1d5db !important;
            cursor: not-allowed !important;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 999;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .tab-active {
            background-color: var(--primary-color) !important;
            color: white !important;
            font-weight: 600;
        }
        
        .tab-inactive {
            background-color: #f1f5f9 !important;
            color: #64748b !important;
        }
        
        .tab-inactive:hover {
            background-color: #e2e8f0 !important;
        }
        
        .branch-jordan {
            border-left: 4px solid #3b82f6;
        }
        
        .branch-wanchai {
            border-left: 4px solid #10b981;
        }
        
        .branch-tsuenwan {
            border-left: 4px solid #8b5cf6;
        }
        
        .room-card {
            transition: all 0.2s ease;
            border: 1px solid #e2e8f0;
        }
        
        .room-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }
        
        .stats-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 12px;
            padding: 20px;
        }
        
        .receipt-template {
            background: white;
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* 數據庫模擬器樣式 */
        .db-debug {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9999;
            max-width: 300px;
            display: none;
        }
    </style>
</head>
<body class="h-full">
    <!-- 登入畫面 | Login Screen -->
    <div id="loginScreen" class="h-full flex items-center justify-center p-4 bg-gradient-to-br from-blue-50 to-indigo-100">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-door-open text-white text-3xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 english-font">Counselling Room Booking System</h1>
                <p class="text-gray-600 chinese-font">心理輔導室預約系統</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                        <span class="english">Name</span>
                        <span class="chinese">姓名</span>
                    </label>
                    <input type="text" id="loginName" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition english-font" placeholder="Enter your name / 輸入姓名">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                        <span class="english">Password</span>
                        <span class="chinese">密碼</span>
                    </label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Enter password / 輸入密碼">
                </div>
                
                <div id="loginError" class="hidden text-red-500 text-sm text-center"></div>
                
                <button onclick="handleLogin()" class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 rounded-xl font-medium hover:from-blue-600 hover:to-indigo-700 transition transform hover:scale-[1.02] active:scale-[0.98] shadow-md">
                    <span class="english-font">Login</span>
                    <span class="chinese-font ml-2">登入</span>
                </button>
            </div>
            
            <div class="mt-6 pt-6 border-t border-gray-200">
                <button onclick="showStaffLogin()" class="w-full text-gray-600 hover:text-gray-800 text-sm flex items-center justify-center gap-2">
                    <i class="fas fa-user-cog"></i>
                    <span class="english-font">Staff Login</span>
                    <span class="chinese-font ml-2">職員登入</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- 租用者儀表板 | Renter Dashboard -->
    <div id="renterDashboard" class="hidden h-full flex flex-col">
        <!-- 頂部導航欄 | Header -->
        <header class="bg-white shadow-sm sticky top-0 z-40 no-print">
            <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-door-open text-white"></i>
                    </div>
                    <div class="bilingual-text">
                        <div class="english-font font-semibold text-gray-800">Room Booking</div>
                        <div class="chinese-font text-sm text-gray-500">歡迎, <span id="renterWelcomeName" class="font-medium"></span></div>
                    </div>
                </div>
                
                <button onclick="logout()" class="px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition flex items-center gap-2">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="english-font">Logout</span>
                    <span class="chinese-font ml-1">登出</span>
                </button>
            </div>
        </header>
        
        <!-- 主要內容區 | Main Content -->
        <main class="flex-1 overflow-auto">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <!-- 頁籤導航 | Tab Navigation -->
                <div class="flex gap-2 mb-6 no-print">
                    <button onclick="showRenterTab('booking')" id="renterTabBooking" class="tab-active px-4 py-2 rounded-lg font-medium transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Book Room</div>
                            <div class="chinese chinese-font text-xs">預約房間</div>
                        </div>
                    </button>
                    <button onclick="showRenterTab('myBookings')" id="renterTabMyBookings" class="tab-inactive px-4 py-2 rounded-lg font-medium transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">My Bookings</div>
                            <div class="chinese chinese-font text-xs">我的預約</div>
                        </div>
                    </button>
                    <button onclick="showRenterTab('statistics')" id="renterTabStatistics" class="tab-inactive px-4 py-2 rounded-lg font-medium transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Statistics</div>
                            <div class="chinese chinese-font text-xs">統計</div>
                        </div>
                    </button>
                </div>
                
                <!-- 預約房間區 | Booking Section -->
                <div id="renterBookingSection" class="fade-in">
                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                        <div class="bilingual-text mb-4">
                            <div class="english english-font text-lg font-semibold text-gray-800 flex items-center">
                                <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>
                                Select Branch & Date
                            </div>
                            <div class="chinese chinese-font text-gray-600">選擇分店及日期</div>
                        </div>
                        
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                                    <span class="english">Branch</span>
                                    <span class="chinese">分店</span>
                                </label>
                                <select id="renterBranchSelect" onchange="loadRoomsForBranch()" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select Branch / 選擇分店</option>
                                    <option value="jordan">Jordan / 佐敦</option>
                                    <option value="wanchai">Wan Chai / 灣仔</option>
                                    <option value="tsuenwan">Tsuen Wan / 荃灣</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                                    <span class="english">Date</span>
                                    <span class="chinese">日期</span>
                                </label>
                                <input type="date" id="renterDateSelect" onchange="loadTimeSlots()" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                                    <span class="english">Room</span>
                                    <span class="chinese">房間</span>
                                </label>
                                <select id="renterRoomSelect" onchange="loadTimeSlots()" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select Room / 選擇房間</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 房間資訊 | Room Info -->
                    <div id="selectedRoomInfo" class="hidden bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 mb-6">
                        <div class="flex items-start justify-between">
                            <div>
                                <h3 id="roomInfoName" class="text-xl font-semibold text-gray-800 english-font"></h3>
                                <p id="roomInfoFacilities" class="text-gray-600 mt-1 chinese-font"></p>
                            </div>
                            <div class="text-right">
                                <div class="bilingual-text">
                                    <div class="english english-font text-sm text-gray-500">Price</div>
                                    <div class="chinese chinese-font text-sm text-gray-500">租金</div>
                                </div>
                                <p id="roomInfoPrice" class="text-2xl font-bold text-blue-600"></p>
                                <div class="bilingual-text">
                                    <div class="english english-font text-xs text-gray-400">per hour</div>
                                    <div class="chinese chinese-font text-xs text-gray-400">每小時</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 時間段選擇 | Time Slots -->
                    <div id="timeSlotsContainer" class="hidden bg-white rounded-2xl shadow-lg p-6">
                        <div class="bilingual-text mb-4">
                            <div class="english english-font text-lg font-semibold text-gray-800 flex items-center">
                                <i class="far fa-clock text-blue-500 mr-2"></i>
                                Available Time Slots
                            </div>
                            <div class="chinese chinese-font text-gray-600">可預約時段</div>
                        </div>
                        
                        <div class="bilingual-text mb-4">
                            <div class="english english-font text-sm text-gray-500">Click to select time slots (each slot = 30 mins)</div>
                            <div class="chinese chinese-font text-sm text-gray-500">點擊選擇時段（每格=30分鐘）</div>
                        </div>
                        
                        <div id="timeSlots" class="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2"></div>
                        
                        <!-- 玩具租用選項 | Toy Rental Option -->
                        <div id="toyRentalOption" class="hidden mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-xl">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" id="toyRentalCheckbox" onchange="updateBookingTotal()" class="w-5 h-5 text-yellow-600 rounded focus:ring-yellow-500">
                                <div>
                                    <div class="bilingual-text">
                                        <div class="english english-font text-gray-700 font-medium">Add Toy Rental</div>
                                        <div class="chinese chinese-font text-gray-700 font-medium">租用玩具</div>
                                    </div>
                                    <div class="bilingual-text mt-1">
                                        <div class="english english-font text-sm text-gray-500">Additional <span id="toyPriceDisplay"></span>/hr</div>
                                        <div class="chinese chinese-font text-sm text-gray-500">每小時另加顯示金額</div>
                                    </div>
                                </div>
                            </label>
                        </div>
                        
                        <!-- 預約摘要 | Booking Summary -->
                        <div id="bookingSummary" class="hidden mt-6 p-6 bg-blue-50 rounded-xl border border-blue-200">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <div class="bilingual-text">
                                        <div class="english english-font text-sm text-gray-600">Selected Time</div>
                                        <div class="chinese chinese-font text-sm text-gray-600">已選時段</div>
                                    </div>
                                    <p id="selectedTimeRange" class="font-semibold text-gray-800 text-lg mt-1"></p>
                                </div>
                                <div class="text-right">
                                    <div class="bilingual-text">
                                        <div class="english english-font text-sm text-gray-600">Total</div>
                                        <div class="chinese chinese-font text-sm text-gray-600">總計</div>
                                    </div>
                                    <p id="bookingTotal" class="text-2xl font-bold text-blue-600 mt-1"></p>
                                </div>
                            </div>
                            
                            <button onclick="confirmBooking()" class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 rounded-xl font-medium hover:from-blue-600 hover:to-indigo-700 transition shadow-md">
                                <span class="english-font">Confirm Booking</span>
                                <span class="chinese-font ml-2">確認預約</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 我的預約區 | My Bookings Section -->
                <div id="renterMyBookingsSection" class="hidden fade-in">
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <div class="bilingual-text mb-4">
                            <div class="english english-font text-lg font-semibold text-gray-800 flex items-center">
                                <i class="far fa-calendar-check text-blue-500 mr-2"></i>
                                My Bookings
                            </div>
                            <div class="chinese chinese-font text-gray-600">我的預約</div>
                        </div>
                        
                        <div id="myBookingsList" class="space-y-4"></div>
                        
                        <div id="noBookingsMessage" class="hidden text-center py-12 text-gray-500">
                            <i class="far fa-calendar-times text-5xl text-gray-300 mb-4"></i>
                            <div class="bilingual-text">
                                <div class="english english-font">No bookings yet</div>
                                <div class="chinese chinese-font mt-1">暫無預約</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 統計區 | Statistics Section -->
                <div id="renterStatisticsSection" class="hidden fade-in">
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <div class="bilingual-text">
                                <div class="english english-font text-lg font-semibold text-gray-800 flex items-center">
                                    <i class="fas fa-chart-bar text-blue-500 mr-2"></i>
                                    Monthly Statistics
                                </div>
                                <div class="chinese chinese-font text-gray-600">月度統計</div>
                            </div>
                            
                            <div class="flex items-center gap-2">
                                <select id="statsMonthSelect" onchange="updateRenterStatistics()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></select>
                                <select id="statsYearSelect" onchange="updateRenterStatistics()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></select>
                            </div>
                        </div>
                        
                        <!-- 統計卡片 | Stats Cards -->
                        <div class="grid md:grid-cols-3 gap-4 mb-8">
                            <div class="stats-card">
                                <div class="bilingual-text">
                                    <div class="english english-font text-sm text-blue-600 font-medium">Total Bookings</div>
                                    <div class="chinese chinese-font text-sm text-blue-600 font-medium">總預約次數</div>
                                </div>
                                <p id="statsBookingCount" class="text-3xl font-bold text-blue-700 mt-2">0</p>
                            </div>
                            
                            <div class="stats-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);">
                                <div class="bilingual-text">
                                    <div class="english english-font text-sm text-green-600 font-medium">Total Hours</div>
                                    <div class="chinese chinese-font text-sm text-green-600 font-medium">總時數</div>
                                </div>
                                <p id="statsTotalHours" class="text-3xl font-bold text-green-700 mt-2">0</p>
                            </div>
                            
                            <div class="stats-card" style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);">
                                <div class="bilingual-text">
                                    <div class="english english-font text-sm text-purple-600 font-medium">Total Amount</div>
                                    <div class="chinese chinese-font text-sm text-purple-600 font-medium">總金額</div>
                                </div>
                                <p id="statsTotalAmount" class="text-3xl font-bold text-purple-700 mt-2">$0</p>
                            </div>
                        </div>
                        
                        <div class="bilingual-text mb-3">
                            <div class="english english-font font-semibold text-gray-800">Booking Details</div>
                            <div class="chinese chinese-font text-gray-600">預約詳情</div>
                        </div>
                        
                        <div id="statsBookingDetails" class="space-y-3"></div>
                        
                        <div id="noStatsMessage" class="hidden text-center py-8 text-gray-500">
                            <i class="far fa-chart-bar text-4xl text-gray-300 mb-4"></i>
                            <div class="bilingual-text">
                                <div class="english english-font">No bookings this month</div>
                                <div class="chinese chinese-font mt-1">本月暫無預約</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- 職員儀表板 | Staff Dashboard -->
    <div id="staffDashboard" class="hidden h-full flex flex-col">
        <!-- 職員頂部導航欄 | Staff Header -->
        <header class="bg-gradient-to-r from-slate-800 to-slate-900 shadow-lg sticky top-0 z-40 no-print">
            <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center">
                        <i class="fas fa-user-cog text-white"></i>
                    </div>
                    <div class="bilingual-text">
                        <div class="english english-font font-semibold text-white">Staff Portal</div>
                        <div class="chinese chinese-font text-sm text-slate-300">管理後台</div>
                    </div>
                </div>
                
                <button onclick="logout()" class="px-4 py-2 text-slate-300 hover:text-white hover:bg-white/10 rounded-lg transition flex items-center gap-2">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="english-font">Logout</span>
                    <span class="chinese-font ml-1">登出</span>
                </button>
            </div>
        </header>
        
        <!-- 職員主要內容區 | Staff Main Content -->
        <main class="flex-1 overflow-auto">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <!-- 職員頁籤導航 | Staff Tab Navigation -->
                <div class="flex flex-wrap gap-2 mb-6 no-print">
                    <button onclick="showStaffTab('renters')" id="staffTabRenters" class="px-4 py-2 rounded-lg font-medium transition bg-slate-800 text-white">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Manage Renters</div>
                            <div class="chinese chinese-font text-xs">管理租用者</div>
                        </div>
                    </button>
                    <button onclick="showStaffTab('rooms')" id="staffTabRooms" class="tab-inactive px-4 py-2 rounded-lg font-medium transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Room Settings</div>
                            <div class="chinese chinese-font text-xs">房間設定</div>
                        </div>
                    </button>
                    <button onclick="showStaffTab('allBookings')" id="staffTabAllBookings" class="tab-inactive px-4 py-2 rounded-lg font-medium transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">All Bookings</div>
                            <div class="chinese chinese-font text-xs">所有預約</div>
                        </div>
                    </button>
                    <button onclick="showStaffTab('reports')" id="staffTabReports" class="tab-inactive px-4 py-2 rounded-lg font-medium transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Reports</div>
                            <div class="chinese chinese-font text-xs">報表</div>
                        </div>
                    </button>
                </div>
                
                <!-- 管理租用者區 | Manage Renters Section -->
                <div id="staffRentersSection" class="fade-in">
                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bilingual-text">
                                <div class="english english-font text-lg font-semibold text-gray-800 flex items-center">
                                    <i class="fas fa-users text-slate-700 mr-2"></i>
                                    Renters
                                </div>
                                <div class="chinese chinese-font text-gray-600">租用者</div>
                            </div>
                            
                            <button onclick="showAddRenterModal()" class="px-4 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 transition flex items-center gap-2">
                                <i class="fas fa-user-plus"></i>
                                <span class="english-font">Add Renter</span>
                                <span class="chinese-font ml-1">新增租用者</span>
                            </button>
                        </div>
                        
                        <div id="rentersList" class="space-y-3"></div>
                        
                        <div id="noRentersMessage" class="hidden text-center py-8 text-gray-500">
                            <i class="fas fa-users-slash text-4xl text-gray-300 mb-4"></i>
                            <div class="bilingual-text">
                                <div class="english english-font">No renters registered</div>
                                <div class="chinese chinese-font mt-1">暫無租用者</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 房間設定區 | Room Settings Section -->
                <div id="staffRoomsSection" class="hidden fade-in">
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <div class="bilingual-text mb-4">
                            <div class="english english-font text-lg font-semibold text-gray-800 flex items-center">
                                <i class="fas fa-cog text-slate-700 mr-2"></i>
                                Room Price Settings
                            </div>
                            <div class="chinese chinese-font text-gray-600">房間價格設定</div>
                        </div>
                        
                        <div class="bilingual-text mb-6">
                            <div class="english english-font text-sm text-gray-500">Changes will only affect new bookings</div>
                            <div class="chinese chinese-font text-sm text-gray-500">更改只會影響新預約</div>
                        </div>
                        
                        <div class="space-y-8">
                            <!-- 佐敦分店 | Jordan Branch -->
                            <div>
                                <h3 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                    <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                                    <div class="bilingual-text">
                                        <div class="english english-font">Jordan</div>
                                        <div class="chinese chinese-font text-gray-600">佐敦</div>
                                    </div>
                                </h3>
                                <div id="jordanRooms" class="grid md:grid-cols-2 gap-3"></div>
                            </div>
                            
                            <!-- 灣仔分店 | Wan Chai Branch -->
                            <div>
                                <h3 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                    <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                                    <div class="bilingual-text">
                                        <div class="english english-font">Wan Chai</div>
                                        <div class="chinese chinese-font text-gray-600">灣仔</div>
                                    </div>
                                </h3>
                                <div id="wanchaiRooms" class="grid md:grid-cols-2 gap-3"></div>
                            </div>
                            
                            <!-- 荃灣分店 | Tsuen Wan Branch -->
                            <div>
                                <h3 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                    <span class="w-3 h-3 bg-purple-500 rounded-full"></span>
                                    <div class="bilingual-text">
                                        <div class="english english-font">Tsuen Wan</div>
                                        <div class="chinese chinese-font text-gray-600">荃灣</div>
                                    </div>
                                </h3>
                                <div id="tsuenwanRooms" class="grid md:grid-cols-2 gap-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 所有預約區 | All Bookings Section -->
                <div id="staffAllBookingsSection" class="hidden fade-in">
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bilingual-text">
                                <div class="english english-font text-lg font-semibold text-gray-800 flex items-center">
                                    <i class="fas fa-calendar-alt text-slate-700 mr-2"></i>
                                    All Bookings
                                </div>
                                <div class="chinese chinese-font text-gray-600">所有預約</div>
                            </div>
                            
                            <div class="flex items-center gap-2">
                                <select id="staffBookingFilter" onchange="filterStaffBookings()" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="all">All Renters / 所有租用者</option>
                                </select>
                                
                                <select id="staffBranchFilter" onchange="filterStaffBookings()" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="all">All Branches / 所有分店</option>
                                    <option value="jordan">Jordan / 佐敦</option>
                                    <option value="wanchai">Wan Chai / 灣仔</option>
                                    <option value="tsuenwan">Tsuen Wan / 荃灣</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="allBookingsList" class="space-y-3"></div>
                        
                        <div id="noAllBookingsMessage" class="hidden text-center py-8 text-gray-500">
                            <i class="far fa-calendar-times text-4xl text-gray-300 mb-4"></i>
                            <div class="bilingual-text">
                                <div class="english english-font">No bookings found</div>
                                <div class="chinese chinese-font mt-1">找不到預約</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 報表區 | Reports Section -->
                <div id="staffReportsSection" class="hidden fade-in">
                    <!-- 月度報表 | Monthly Report -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bilingual-text">
                                <div class="english english-font text-lg font-semibold text-gray-800 flex items-center">
                                    <i class="fas fa-chart-pie text-slate-700 mr-2"></i>
                                    Monthly Report
                                </div>
                                <div class="chinese chinese-font text-gray-600">月度報表</div>
                            </div>
                            
                            <div class="flex items-center gap-2">
                                <select id="reportMonthSelect" onchange="generateReport()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></select>
                                
                                <select id="reportYearSelect" onchange="generateReport()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></select>
                                
                                <button onclick="printReport()" class="px-4 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 transition flex items-center gap-2">
                                    <i class="fas fa-print"></i>
                                    <span class="english-font">Print</span>
                                    <span class="chinese-font ml-1">列印</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- 列印表頭 | Print Header -->
                        <div class="print-header hidden print-only mb-6">
                            <div class="text-center">
                                <h1 class="text-2xl font-bold text-gray-800 english-font">Monthly Booking Report</h1>
                                <h2 class="text-xl text-gray-600 chinese-font">月度預約報表</h2>
                            </div>
                            <div class="flex justify-between mt-4 text-sm">
                                <div>
                                    <p id="printReportPeriod" class="font-medium"></p>
                                </div>
                                <div>
                                    <p id="printGeneratedDate" class="text-gray-500"></p>
                                </div>
                            </div>
                            <hr class="my-4 border-gray-300">
                        </div>
                        
                        <div id="reportContent">
                            <!-- 統計摘要 | Statistics Summary -->
                            <div class="grid md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-slate-50 rounded-xl p-4 print-border">
                                    <div class="bilingual-text">
                                        <div class="english english-font text-sm text-slate-600">Total Bookings</div>
                                        <div class="chinese chinese-font text-sm text-slate-600">總預約</div>
                                    </div>
                                    <p id="reportTotalBookings" class="text-2xl font-bold text-slate-800 mt-1">0</p>
                                </div>
                                
                                <div class="bg-slate-50 rounded-xl p-4 print-border">
                                    <div class="bilingual-text">
                                        <div class="english english-font text-sm text-slate-600">Total Hours</div>
                                        <div class="chinese chinese-font text-sm text-slate-600">總時數</div>
                                    </div>
                                    <p id="reportTotalHours" class="text-2xl font-bold text-slate-800 mt-1">0</p>
                                </div>
                                
                                <div class="bg-slate-50 rounded-xl p-4 print-border">
                                    <div class="bilingual-text">
                                        <div class="english english-font text-sm text-slate-600">Total Revenue</div>
                                        <div class="chinese chinese-font text-sm text-slate-600">總收入</div>
                                    </div>
                                    <p id="reportTotalRevenue" class="text-2xl font-bold text-slate-800 mt-1">$0</p>
                                </div>
                                
                                <div class="bg-slate-50 rounded-xl p-4 print-border">
                                    <div class="bilingual-text">
                                        <div class="english english-font text-sm text-slate-600">Active Renters</div>
                                        <div class="chinese chinese-font text-sm text-slate-600">活躍租用者</div>
                                    </div>
                                    <p id="reportActiveRenters" class="text-2xl font-bold text-slate-800 mt-1">0</p>
                                </div>
                            </div>
                            
                            <div class="bilingual-text mb-3">
                                <div class="english english-font font-semibold text-gray-800">Breakdown by Renter</div>
                                <div class="chinese chinese-font text-gray-600">按租用者分類</div>
                            </div>
                            
                            <div id="reportByRenter" class="space-y-4"></div>
                            
                            <div id="noReportMessage" class="hidden text-center py-8 text-gray-500">
                                <i class="fas fa-chart-line text-4xl text-gray-300 mb-4"></i>
                                <div class="bilingual-text">
                                    <div class="english english-font">No bookings this month</div>
                                    <div class="chinese chinese-font mt-1">本月暫無預約</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 列印表尾 | Print Footer -->
                        <div class="print-footer hidden print-only mt-8 pt-4 border-t border-gray-300">
                            <div class="flex justify-between text-xs text-gray-500">
                                <div>
                                    <p class="english-font">Generated by Counselling Room Booking System</p>
                                    <p class="chinese-font">心理輔導室預約系統生成</p>
                                </div>
                                <div class="text-right">
                                    <p class="english-font">Page <span class="page-number"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 生成收據 | Generate Receipt -->
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bilingual-text">
                                <div class="english english-font text-lg font-semibold text-gray-800 flex items-center">
                                    <i class="fas fa-receipt text-slate-700 mr-2"></i>
                                    Generate Receipt
                                </div>
                                <div class="chinese chinese-font text-gray-600">生成收據</div>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-4 mb-6">
                            <select id="receiptRenterSelect" class="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Renter / 選擇租用者</option>
                            </select>
                            
                            <button onclick="generateReceipt()" class="px-6 py-3 bg-slate-800 text-white rounded-xl hover:bg-slate-700 transition">
                                <span class="english-font">Generate</span>
                                <span class="chinese-font ml-2">生成</span>
                            </button>
                        </div>
                        
                        <div id="receiptPreview" class="hidden receipt-template"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- 模態框 | Modals -->
    
    <!-- 新增租用者模態框 | Add Renter Modal -->
    <div id="addRenterModal" class="hidden modal-overlay">
        <div class="modal-content">
            <div class="p-6">
                <div class="bilingual-text mb-4">
                    <div class="english english-font text-xl font-semibold text-gray-800">Add New Renter</div>
                    <div class="chinese chinese-font text-gray-600">新增租用者</div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                            <span class="english">Name <span class="text-red-500">*</span></span>
                            <span class="chinese">姓名</span>
                        </label>
                        <input type="text" id="newRenterName" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 english-font" placeholder="Enter renter name / 輸入租用者姓名">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                            <span class="english">Password <span class="text-red-500">*</span></span>
                            <span class="chinese">密碼</span>
                        </label>
                        <input type="text" id="newRenterPassword" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Set password for renter / 為租用者設定密碼">
                        <div class="bilingual-text mt-1">
                            <div class="english english-font text-xs text-gray-500">Password is visible for recovery</div>
                            <div class="chinese chinese-font text-xs text-gray-500">密碼可見以便找回</div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                            <span class="english">Email</span>
                            <span class="chinese">電郵</span>
                        </label>
                        <input type="email" id="newRenterEmail" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter email address / 輸入電郵地址">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                            <span class="english">Phone</span>
                            <span class="chinese">電話</span>
                        </label>
                        <input type="tel" id="newRenterPhone" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter phone number / 輸入電話號碼">
                    </div>
                </div>
                
                <div id="addRenterError" class="hidden mt-4 text-red-500 text-sm"></div>
                
                <div class="flex gap-3 mt-6">
                    <button onclick="closeAddRenterModal()" class="flex-1 px-4 py-3 border border-gray-300 rounded-xl text-gray-600 hover:bg-gray-50 transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Cancel</div>
                            <div class="chinese chinese-font text-xs">取消</div>
                        </div>
                    </button>
                    <button onclick="addRenter()" id="addRenterBtn" class="flex-1 px-4 py-3 bg-slate-800 text-white rounded-xl hover:bg-slate-700 transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Add</div>
                            <div class="chinese chinese-font text-xs">新增</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 編輯租用者模態框 | Edit Renter Modal -->
    <div id="editRenterModal" class="hidden modal-overlay">
        <div class="modal-content">
            <div class="p-6">
                <div class="bilingual-text mb-4">
                    <div class="english english-font text-xl font-semibold text-gray-800">Edit Renter</div>
                    <div class="chinese chinese-font text-gray-600">編輯租用者</div>
                </div>
                
                <input type="hidden" id="editRenterId">
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                            <span class="english">Name <span class="text-red-500">*</span></span>
                            <span class="chinese">姓名</span>
                        </label>
                        <input type="text" id="editRenterName" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 english-font">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                            <span class="english">Password <span class="text-red-500">*</span></span>
                            <span class="chinese">密碼</span>
                        </label>
                        <input type="text" id="editRenterPassword" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <div class="bilingual-text mt-1">
                            <div class="english english-font text-xs text-gray-500">Password is visible for recovery</div>
                            <div class="chinese chinese-font text-xs text-gray-500">密碼可見以便找回</div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                            <span class="english">Email</span>
                            <span class="chinese">電郵</span>
                        </label>
                        <input type="email" id="editRenterEmail" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                            <span class="english">Phone</span>
                            <span class="chinese">電話</span>
                        </label>
                        <input type="tel" id="editRenterPhone" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                
                <div id="editRenterError" class="hidden mt-4 text-red-500 text-sm"></div>
                
                <div class="flex gap-3 mt-6">
                    <button onclick="closeEditRenterModal()" class="flex-1 px-4 py-3 border border-gray-300 rounded-xl text-gray-600 hover:bg-gray-50 transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Cancel</div>
                            <div class="chinese chinese-font text-xs">取消</div>
                        </div>
                    </button>
                    <button onclick="saveRenterEdit()" id="saveRenterBtn" class="flex-1 px-4 py-3 bg-slate-800 text-white rounded-xl hover:bg-slate-700 transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Save</div>
                            <div class="chinese chinese-font text-xs">儲存</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 職員登入模態框 | Staff Login Modal -->
    <div id="staffLoginModal" class="hidden modal-overlay">
        <div class="modal-content">
            <div class="p-6">
                <div class="bilingual-text mb-4">
                    <div class="english english-font text-xl font-semibold text-gray-800">Staff Login</div>
                    <div class="chinese chinese-font text-gray-600">職員登入</div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 bilingual-label">
                            <span class="english">Password</span>
                            <span class="chinese">密碼</span>
                        </label>
                        <input type="password" id="staffPassword" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter staff password / 輸入職員密碼">
                    </div>
                </div>
                
                <div id="staffLoginError" class="hidden mt-4 text-red-500 text-sm"></div>
                
                <div class="flex gap-3 mt-6">
                    <button onclick="closeStaffLogin()" class="flex-1 px-4 py-3 border border-gray-300 rounded-xl text-gray-600 hover:bg-gray-50 transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Cancel</div>
                            <div class="chinese chinese-font text-xs">取消</div>
                        </div>
                    </button>
                    <button onclick="handleStaffLogin()" class="flex-1 px-4 py-3 bg-slate-800 text-white rounded-xl hover:bg-slate-700 transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Login</div>
                            <div class="chinese chinese-font text-xs">登入</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 取消預約確認模態框 | Cancel Booking Confirmation Modal -->
    <div id="cancelBookingModal" class="hidden modal-overlay">
        <div class="modal-content">
            <div class="p-6 text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
                </div>
                
                <div class="bilingual-text mb-2">
                    <div class="english english-font text-xl font-semibold text-gray-800">Cancel Booking?</div>
                    <div class="chinese chinese-font text-gray-600">取消預約？</div>
                </div>
                
                <p id="cancelBookingDetails" class="text-gray-600 mb-6"></p>
                
                <input type="hidden" id="cancelBookingId">
                
                <div class="flex gap-3">
                    <button onclick="closeCancelBookingModal()" class="flex-1 px-4 py-3 border border-gray-300 rounded-xl text-gray-600 hover:bg-gray-50 transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Keep</div>
                            <div class="chinese chinese-font text-xs">保留</div>
                        </div>
                    </button>
                    <button onclick="confirmCancelBooking()" id="confirmCancelBtn" class="flex-1 px-4 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition">
                        <div class="bilingual-text items-center">
                            <div class="english english-font">Cancel Booking</div>
                            <div class="chinese chinese-font text-xs">取消預約</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 通知訊息 | Toast Notification -->
    <div id="toast" class="hidden toast"></div>
    
    <script>
        // ============ 系統配置 | System Configuration ============
        const defaultConfig = {
            system_title: 'Counselling Room Booking System / 心理輔導室預約系統'
        };
        
        let config = { ...defaultConfig };
        
        // ============ 狀態管理 | State Management ============
        // 使用 localStorage 模擬數據庫 | Using localStorage to simulate database
        let renters = JSON.parse(localStorage.getItem('roomBooking_renters')) || [];
        let bookings = JSON.parse(localStorage.getItem('roomBooking_bookings')) || [];
        let roomPrices = JSON.parse(localStorage.getItem('roomBooking_roomPrices')) || [];
        let currentUser = null;
        let isStaff = false;
        let selectedSlots = [];
        const staffPassword = '123'; // 職員默認密碼 | Staff default password
        
        // 默認房間配置 | Default room configuration
        const defaultRooms = {
            jordan: [
                { id: 'jordan-c', name: 'Room C / 房間 C', price: 140, facilities: 'Hypnotic Chair / 催眠椅', toyAvailable: false, toyPricePerHour: 0 },
                { id: 'jordan-d', name: 'Room D / 房間 D', price: 190, facilities: 'Group Therapy, Sandplay Therapy / 小組、沙盤遊戲治療', toyAvailable: true, toyPricePerHour: 50 },
                { id: 'jordan-e', name: 'Room E / 房間 E', price: 170, facilities: 'Large Room for Family Therapy / 大房 家庭治療', toyAvailable: false, toyPricePerHour: 0 },
                { id: 'jordan-f', name: 'Room F / 房間 F', price: 150, facilities: 'Floor-to-ceiling Window Counselling Room / 落地窗輔導室', toyAvailable: false, toyPricePerHour: 0 },
                { id: 'jordan-g', name: 'Room G / 房間 G', price: 150, facilities: 'Floor-to-ceiling Window Counselling Room / 落地窗輔導室', toyAvailable: false, toyPricePerHour: 0 }
            ],
            wanchai: [
                { id: 'wanchai-1', name: 'Room 1 / 房間 1', price: 160, facilities: 'Large Window Room, Long Sofa / 窗口大房、長梳化', toyAvailable: false, toyPricePerHour: 0 },
                { id: 'wanchai-2', name: 'Room 2 / 房間 2', price: 140, facilities: 'Comfortable Counselling Room / 舒適輔導室', toyAvailable: false, toyPricePerHour: 0 },
                { id: 'wanchai-3', name: 'Room 3 / 房間 3', price: 140, facilities: 'Comfortable Counselling Room / 舒適輔導室', toyAvailable: false, toyPricePerHour: 0 },
                { id: 'wanchai-4', name: 'Room 4 / 房間 4', price: 180, facilities: 'Group Therapy, Sandplay Therapy / 小組、沙盤遊戲治療', toyAvailable: true, toyPricePerHour: 40 }
            ],
            tsuenwan: [
                { id: 'tsuenwan-5', name: 'Room 5 / 房間 5', price: 130, facilities: 'Counselling Room / 輔導室', toyAvailable: false, toyPricePerHour: 0 },
                { id: 'tsuenwan-6', name: 'Room 6 / 房間 6', price: 140, facilities: 'Counselling Room / 輔導室', toyAvailable: false, toyPricePerHour: 0 },
                { id: 'tsuenwan-7', name: 'Room 7 / 房間 7', price: 140, facilities: 'Counselling Room / 輔導室', toyAvailable: false, toyPricePerHour: 0 },
                { id: 'tsuenwan-8', name: 'Room 8 / 房間 8', price: 160, facilities: 'Large Window Counselling Room / 大窗輔導室', toyAvailable: false, toyPricePerHour: 0 }
            ]
        };
        
        // ============ 應用初始化 | Application Initialization ============
        function initApp() {
            console.log('Initializing application... / 初始化應用...');
            
            // 設置默認日期 | Set default date
            const today = new Date();
            document.getElementById('renterDateSelect').value = today.toISOString().split('T')[0];
            document.getElementById('renterDateSelect').min = today.toISOString().split('T')[0];
            
            // 初始化月份/年份選擇 | Initialize month/year selects
            initDateSelects();
            
            // 如果有示例數據，添加一些初始數據 | Add some initial data if there are no sample data
            if (renters.length === 0) {
                addSampleData();
            }
            
            // 更新UI | Update UI
            updateUI();
        }
        
        function initDateSelects() {
            const months = [
                'January / 一月', 'February / 二月', 'March / 三月', 'April / 四月',
                'May / 五月', 'June / 六月', 'July / 七月', 'August / 八月',
                'September / 九月', 'October / 十月', 'November / 十一月', 'December / 十二月'
            ];
            
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth();
            
            // 租用者統計選擇 | Renter statistics selects
            const statsMonthSelect = document.getElementById('statsMonthSelect');
            const statsYearSelect = document.getElementById('statsYearSelect');
            
            statsMonthSelect.innerHTML = '';
            months.forEach((month, index) => {
                statsMonthSelect.innerHTML += `<option value="${index}" ${index === currentMonth ? 'selected' : ''}>${month}</option>`;
            });
            
            statsYearSelect.innerHTML = '';
            for (let year = currentYear - 1; year <= currentYear + 1; year++) {
                statsYearSelect.innerHTML += `<option value="${year}" ${year === currentYear ? 'selected' : ''}>${year}</option>`;
            }
            
            // 職員報表選擇 | Staff report selects
            const reportMonthSelect = document.getElementById('reportMonthSelect');
            const reportYearSelect = document.getElementById('reportYearSelect');
            
            reportMonthSelect.innerHTML = '';
            months.forEach((month, index) => {
                reportMonthSelect.innerHTML += `<option value="${index}" ${index === currentMonth ? 'selected' : ''}>${month}</option>`;
            });
            
            reportYearSelect.innerHTML = '';
            for (let year = currentYear - 1; year <= currentYear + 1; year++) {
                reportYearSelect.innerHTML += `<option value="${year}" ${year === currentYear ? 'selected' : ''}>${year}</option>`;
            }
        }
        
        function addSampleData() {
            // 添加示例租用者 | Add sample renters
            const sampleRenters = [
                { id: generateId(), name: 'Dr. Smith / 史密斯醫生', password: 'smith123', email: 'smith@example.com', phone: '9123-4567', createdAt: new Date().toISOString() },
                { id: generateId(), name: 'Dr. Wong / 王醫生', password: 'wong123', email: 'wong@example.com', phone: '9876-5432', createdAt: new Date().toISOString() },
                { id: generateId(), name: 'Dr. Johnson / 約翰遜醫生', password: 'johnson123', email: 'johnson@example.com', phone: '9234-5678', createdAt: new Date().toISOString() }
            ];
            
            renters = [...sampleRenters];
            saveData('renters', renters);
            
            // 添加示例預約 | Add sample bookings
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const sampleBookings = [
                { 
                    id: generateId(), 
                    renterId: sampleRenters[0].id, 
                    renterName: sampleRenters[0].name,
                    roomId: 'jordan-c', 
                    roomName: 'Room C / 房間 C', 
                    branch: 'jordan',
                    date: today.toISOString().split('T')[0], 
                    startTime: '10:00', 
                    endTime: '11:00',
                    basePrice: 140,
                    toyRental: false,
                    toyPrice: 0,
                    totalPrice: 280,
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                { 
                    id: generateId(), 
                    renterId: sampleRenters[1].id, 
                    renterName: sampleRenters[1].name,
                    roomId: 'wanchai-4', 
                    roomName: 'Room 4 / 房間 4', 
                    branch: 'wanchai',
                    date: tomorrow.toISOString().split('T')[0], 
                    startTime: '14:00', 
                    endTime: '15:30',
                    basePrice: 180,
                    toyRental: true,
                    toyPrice: 60,
                    totalPrice: 330,
                    status: 'active',
                    createdAt: new Date().toISOString()
                }
            ];
            
            bookings = [...sampleBookings];
            saveData('bookings', bookings);
            
            showToast('Sample data loaded / 示例數據已載入', 'info');
        }
        
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        // ============ 數據保存/加載 | Data Save/Load ============
        function saveData(type, data) {
            localStorage.setItem(`roomBooking_${type}`, JSON.stringify(data));
        }
        
        function loadData(type) {
            return JSON.parse(localStorage.getItem(`roomBooking_${type}`)) || [];
        }
        
        // ============ UI更新函數 | UI Update Functions ============
        function updateUI() {
            if (isStaff) {
                updateStaffUI();
            } else if (currentUser) {
                updateRenterUI();
            }
        }
        
        function updateStaffUI() {
            renderRentersList();
            renderRoomSettings();
            renderAllBookings();
            generateReport();
            updateReceiptRenterSelect();
        }
        
        function updateRenterUI() {
            renderMyBookings();
            updateRenterStatistics();
            loadTimeSlots();
        }
        
        // ============ 認證功能 | Authentication Functions ============
        function handleLogin() {
            const name = document.getElementById('loginName').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!name || !password) {
                showLoginError('Please enter name and password / 請輸入姓名和密碼');
                return;
            }
            
            const renter = renters.find(r => {
                const names = r.name.split('/').map(n => n.trim());
                return (names[0].toLowerCase() === name.toLowerCase() || 
                       (names[1] && names[1].toLowerCase() === name.toLowerCase())) && 
                       r.password === password;
            });
            
            if (renter) {
                currentUser = renter;
                isStaff = false;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('renterDashboard').classList.remove('hidden');
                document.getElementById('renterWelcomeName').textContent = renter.name.split('/')[0].trim();
                updateRenterUI();
                showToast('Login successful / 登入成功', 'success');
            } else {
                showLoginError('Invalid name or password / 姓名或密碼錯誤');
            }
        }
        
        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }
        
        function showStaffLogin() {
            document.getElementById('staffLoginModal').classList.remove('hidden');
        }
        
        function closeStaffLogin() {
            document.getElementById('staffLoginModal').classList.add('hidden');
            document.getElementById('staffPassword').value = '';
            document.getElementById('staffLoginError').classList.add('hidden');
        }
        
        function handleStaffLogin() {
            const password = document.getElementById('staffPassword').value;
            
            if (password === staffPassword) {
                isStaff = true;
                currentUser = null;
                closeStaffLogin();
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('staffDashboard').classList.remove('hidden');
                updateStaffUI();
                showToast('Staff login successful / 職員登入成功', 'success');
            } else {
                document.getElementById('staffLoginError').textContent = 'Invalid password / 密碼錯誤';
                document.getElementById('staffLoginError').classList.remove('hidden');
            }
        }
        
        function logout() {
            currentUser = null;
            isStaff = false;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('renterDashboard').classList.add('hidden');
            document.getElementById('staffDashboard').classList.add('hidden');
            document.getElementById('loginName').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginError').classList.add('hidden');
        }
        
        // ============ 租用者頁籤導航 | Renter Tab Navigation ============
        function showRenterTab(tab) {
            const tabs = ['booking', 'myBookings', 'statistics'];
            tabs.forEach(t => {
                const tabBtn = document.getElementById(`renterTab${t.charAt(0).toUpperCase() + t.slice(1)}`);
                const section = document.getElementById(`renter${t.charAt(0).toUpperCase() + t.slice(1)}Section`);
                
                tabBtn.classList.remove('tab-active');
                tabBtn.classList.add('tab-inactive');
                section.classList.add('hidden');
            });
            
            const activeTabBtn = document.getElementById(`renterTab${tab.charAt(0).toUpperCase() + tab.slice(1)}`);
            const activeSection = document.getElementById(`renter${tab.charAt(0).toUpperCase() + tab.slice(1)}Section`);
            
            activeTabBtn.classList.remove('tab-inactive');
            activeTabBtn.classList.add('tab-active');
            activeSection.classList.remove('hidden');
        }
        
        // ============ 職員頁籤導航 | Staff Tab Navigation ============
        function showStaffTab(tab) {
            const tabs = ['renters', 'rooms', 'allBookings', 'reports'];
            tabs.forEach(t => {
                const tabBtn = document.getElementById(`staffTab${t.charAt(0).toUpperCase() + t.slice(1)}`);
                const section = document.getElementById(`staff${t.charAt(0).toUpperCase() + t.slice(1)}Section`);
                
                tabBtn.classList.remove('bg-slate-800', 'text-white');
                tabBtn.classList.add('tab-inactive');
                section.classList.add('hidden');
            });
            
            const activeTabBtn = document.getElementById(`staffTab${tab.charAt(0).toUpperCase() + tab.slice(1)}`);
            const activeSection = document.getElementById(`staff${tab.charAt(0).toUpperCase() + tab.slice(1)}Section`);
            
            activeTabBtn.classList.remove('tab-inactive');
            activeTabBtn.classList.add('bg-slate-800', 'text-white');
            activeSection.classList.remove('hidden');
        }
        
        // ============ 房間功能 | Room Functions ============
        function getRoomPrice(roomId) {
            const savedPrice = roomPrices.find(p => p.roomId === roomId);
            if (savedPrice) return savedPrice;
            
            for (const branch in defaultRooms) {
                const room = defaultRooms[branch].find(r => r.id === roomId);
                if (room) return room;
            }
            return null;
        }
        
        function loadRoomsForBranch() {
            const branch = document.getElementById('renterBranchSelect').value;
            const roomSelect = document.getElementById('renterRoomSelect');
            roomSelect.innerHTML = '<option value="">Select Room / 選擇房間</option>';
            
            if (branch && defaultRooms[branch]) {
                defaultRooms[branch].forEach(room => {
                    const price = getRoomPrice(room.id);
                    const displayPrice = price ? price.price * 2 : room.price * 2;
                    roomSelect.innerHTML += `<option value="${room.id}">${room.name} - $${displayPrice}/hr</option>`;
                });
            }
            
            document.getElementById('selectedRoomInfo').classList.add('hidden');
            document.getElementById('timeSlotsContainer').classList.add('hidden');
        }
        
        function loadTimeSlots() {
            const branch = document.getElementById('renterBranchSelect').value;
            const date = document.getElementById('renterDateSelect').value;
            const roomId = document.getElementById('renterRoomSelect').value;
            
            if (!branch || !date || !roomId) {
                document.getElementById('selectedRoomInfo').classList.add('hidden');
                document.getElementById('timeSlotsContainer').classList.add('hidden');
                return;
            }
            
            // 顯示房間資訊 | Show room info
            const room = defaultRooms[branch].find(r => r.id === roomId);
            const roomPrice = getRoomPrice(roomId);
            const price = roomPrice ? roomPrice.price : room.price;
            const toyPrice = roomPrice ? roomPrice.toyPricePerHour : room.toyPricePerHour;
            const pricePerHour = price * 2;
            
            document.getElementById('roomInfoName').textContent = room.name;
            document.getElementById('roomInfoFacilities').textContent = room.facilities;
            document.getElementById('roomInfoPrice').textContent = `$${pricePerHour}`;
            document.getElementById('selectedRoomInfo').classList.remove('hidden');
            
            // 如果房間有玩具租用選項，顯示玩具選項 | If room has toy rental option, show toy option
            if (room.toyAvailable) {
                document.getElementById('toyRentalOption').classList.remove('hidden');
                document.getElementById('toyPriceDisplay').textContent = toyPrice;
            } else {
                document.getElementById('toyRentalOption').classList.add('hidden');
                document.getElementById('toyRentalCheckbox').checked = false;
            }
            
            // 生成時間段 (9:00 AM 到 10:00 PM) | Generate time slots (9:00 AM to 10:00 PM)
            const slotsContainer = document.getElementById('timeSlots');
            slotsContainer.innerHTML = '';
            selectedSlots = [];
            
            const now = new Date();
            const selectedDate = new Date(date);
            const isToday = selectedDate.toDateString() === now.toDateString();
            
            for (let hour = 9; hour < 22; hour++) {
                for (let min = 0; min < 60; min += 30) {
                    const timeStr = `${hour.toString().padStart(2, '0')}:${min.toString().padStart(2, '0')}`;
                    const endHour = min === 30 ? hour + 1 : hour;
                    const endMin = min === 30 ? 0 : 30;
                    const endTimeStr = `${endHour.toString().padStart(2, '0')}:${endMin.toString().padStart(2, '0')}`;
                    
                    // 檢查時段是否已被預約 | Check if slot is already booked
                    const isBooked = bookings.some(b => 
                        b.roomId === roomId && 
                        b.date === date && 
                        b.status === 'active' &&
                        b.startTime <= timeStr && 
                        b.endTime > timeStr
                    );
                    
                    // 檢查時段是否已過去 | Check if slot is in the past
                    const slotTime = new Date(date + 'T' + timeStr);
                    const isPast = isToday && slotTime <= now;
                    
                    const slotDiv = document.createElement('div');
                    slotDiv.className = `p-2 text-center rounded-lg transition ${isBooked ? 'slot-booked' : isPast ? 'slot-past' : 'slot-available'}`;
                    slotDiv.textContent = timeStr;
                    slotDiv.dataset.time = timeStr;
                    slotDiv.dataset.endTime = endTimeStr;
                    
                    if (!isBooked && !isPast) {
                        slotDiv.onclick = () => toggleSlot(slotDiv, timeStr, endTimeStr);
                    }
                    
                    slotsContainer.appendChild(slotDiv);
                }
            }
            
            document.getElementById('timeSlotsContainer').classList.remove('hidden');
            document.getElementById('bookingSummary').classList.add('hidden');
        }
        
        function toggleSlot(element, startTime, endTime) {
            const index = selectedSlots.findIndex(s => s.start === startTime);
            
            if (index > -1) {
                selectedSlots.splice(index, 1);
                element.classList.remove('slot-selected');
                element.classList.add('slot-available');
            } else {
                selectedSlots.push({ start: startTime, end: endTime });
                element.classList.add('slot-selected');
                element.classList.remove('slot-available');
            }
            
            // 按開始時間排序 | Sort by start time
            selectedSlots.sort((a, b) => a.start.localeCompare(b.start));
            
            updateBookingTotal();
        }
        
        function updateBookingTotal() {
            if (selectedSlots.length === 0) {
                document.getElementById('bookingSummary').classList.add('hidden');
                return;
            }
            
            const roomId = document.getElementById('renterRoomSelect').value;
            const branch = document.getElementById('renterBranchSelect').value;
            const room = defaultRooms[branch].find(r => r.id === roomId);
            const roomPrice = getRoomPrice(roomId);
            const basePrice = roomPrice ? roomPrice.price : room.price;
            const toyPrice = roomPrice ? roomPrice.toyPricePerHour : room.toyPricePerHour;
            
            const includeToys = document.getElementById('toyRentalCheckbox').checked;
            const hours = selectedSlots.length * 0.5;
            let total = selectedSlots.length * basePrice;
            
            if (includeToys && room.toyAvailable) {
                total += hours * toyPrice;
            }
            
            // 獲取連續時間範圍 | Get continuous time range
            const firstSlot = selectedSlots[0];
            const lastSlot = selectedSlots[selectedSlots.length - 1];
            
            document.getElementById('selectedTimeRange').textContent = `${firstSlot.start} - ${lastSlot.end} (${hours} hrs / 小時)`;
            document.getElementById('bookingTotal').textContent = `$${total}`;
            document.getElementById('bookingSummary').classList.remove('hidden');
        }
        
        async function confirmBooking() {
            if (selectedSlots.length === 0) return;
            
            const roomId = document.getElementById('renterRoomSelect').value;
            const branch = document.getElementById('renterBranchSelect').value;
            const date = document.getElementById('renterDateSelect').value;
            const room = defaultRooms[branch].find(r => r.id === roomId);
            const roomPrice = getRoomPrice(roomId);
            const basePrice = roomPrice ? roomPrice.price : room.price;
            const toyPrice = roomPrice ? roomPrice.toyPricePerHour : room.toyPricePerHour;
            const includeToys = document.getElementById('toyRentalCheckbox').checked && room.toyAvailable;
            
            const firstSlot = selectedSlots[0];
            const lastSlot = selectedSlots[selectedSlots.length - 1];
            const hours = selectedSlots.length * 0.5;
            let total = selectedSlots.length * basePrice;
            if (includeToys) total += hours * toyPrice;
            
            const booking = {
                id: generateId(),
                renterId: currentUser.id,
                renterName: currentUser.name,
                roomId: roomId,
                roomName: room.name,
                branch: branch,
                date: date,
                startTime: firstSlot.start,
                endTime: lastSlot.end,
                basePrice: basePrice,
                toyRental: includeToys,
                toyPrice: includeToys ? toyPrice * hours : 0,
                totalPrice: total,
                status: 'active',
                createdAt: new Date().toISOString()
            };
            
            const btn = document.querySelector('#bookingSummary button');
            btn.disabled = true;
            btn.innerHTML = '<div class="bilingual-text items-center"><div class="english english-font">Processing...</div><div class="chinese chinese-font text-xs">處理中...</div></div>';
            
            // 模擬API延遲 | Simulate API delay
            setTimeout(() => {
                bookings.push(booking);
                saveData('bookings', bookings);
                
                btn.disabled = false;
                btn.innerHTML = '<span class="english-font">Confirm Booking</span><span class="chinese-font ml-2">確認預約</span>';
                
                showToast('Booking confirmed! / 預約成功！', 'success');
                selectedSlots = [];
                loadTimeSlots();
                renderMyBookings();
                updateRenterStatistics();
            }, 500);
        }
        
        // ============ 我的預約 | My Bookings ============
        function renderMyBookings() {
            const container = document.getElementById('myBookingsList');
            const noBookingsMessage = document.getElementById('noBookingsMessage');
            
            const myBookings = bookings.filter(b => b.renterId === currentUser.id && b.status === 'active');
            
            if (myBookings.length === 0) {
                container.innerHTML = '';
                noBookingsMessage.classList.remove('hidden');
                return;
            }
            
            noBookingsMessage.classList.add('hidden');
            
            // 按日期和時間排序 | Sort by date and time
            myBookings.sort((a, b) => {
                if (a.date !== b.date) return a.date.localeCompare(b.date);
                return a.startTime.localeCompare(b.startTime);
            });
            
            container.innerHTML = myBookings.map(booking => {
                const branchNames = { 
                    jordan: 'Jordan / 佐敦', 
                    wanchai: 'Wan Chai / 灣仔', 
                    tsuenwan: 'Tsuen Wan / 荃灣' 
                };
                const isPast = new Date(booking.date + 'T' + booking.endTime) < new Date();
                
                return `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl ${isPast ? 'opacity-60' : ''}">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 ${booking.branch === 'jordan' ? 'bg-blue-100' : booking.branch === 'wanchai' ? 'bg-green-100' : 'bg-purple-100'} rounded-xl flex items-center justify-center">
                                <i class="fas fa-door-open ${booking.branch === 'jordan' ? 'text-blue-600' : booking.branch === 'wanchai' ? 'text-green-600' : 'text-purple-600'}"></i>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">${booking.roomName} - ${branchNames[booking.branch]}</p>
                                <p class="text-sm text-gray-500">${booking.date} | ${booking.startTime} - ${booking.endTime}</p>
                                ${booking.toyRental ? '<div class="bilingual-text mt-1"><span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded">+ Toy Rental / 玩具</span></div>' : ''}
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-gray-800">$${booking.totalPrice}</p>
                            ${!isPast ? `
                                <button onclick="showCancelBookingModal('${booking.id}', '${booking.roomName}', '${booking.date}', '${booking.startTime}')" 
                                    class="text-sm text-red-500 hover:text-red-700 mt-1">
                                    Cancel / 取消
                                </button>
                            ` : '<div class="bilingual-text"><span class="text-xs text-gray-400">Completed / 已完成</span></div>'}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function showCancelBookingModal(bookingId, roomName, date, time) {
            document.getElementById('cancelBookingId').value = bookingId;
            document.getElementById('cancelBookingDetails').textContent = `${roomName} on ${date} at ${time}`;
            document.getElementById('cancelBookingModal').classList.remove('hidden');
        }
        
        function closeCancelBookingModal() {
            document.getElementById('cancelBookingModal').classList.add('hidden');
        }
        
        async function confirmCancelBooking() {
            const bookingId = document.getElementById('cancelBookingId').value;
            const bookingIndex = bookings.findIndex(b => b.id === bookingId);
            
            if (bookingIndex === -1) {
                showToast('Booking not found / 找不到預約', 'error');
                closeCancelBookingModal();
                return;
            }
            
            const btn = document.getElementById('confirmCancelBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="bilingual-text items-center"><div class="english english-font">Cancelling...</div><div class="chinese chinese-font text-xs">取消中...</div></div>';
            
            // 模擬API延遲 | Simulate API delay
            setTimeout(() => {
                bookings[bookingIndex].status = 'cancelled';
                saveData('bookings', bookings);
                
                btn.disabled = false;
                btn.innerHTML = '<div class="bilingual-text items-center"><div class="english english-font">Cancel Booking</div><div class="chinese chinese-font text-xs">取消預約</div></div>';
                
                showToast('Booking cancelled / 預約已取消', 'success');
                closeCancelBookingModal();
                renderMyBookings();
                updateRenterStatistics();
            }, 500);
        }
        
        // ============ 統計 | Statistics ============
        function updateRenterStatistics() {
            const month = parseInt(document.getElementById('statsMonthSelect').value);
            const year = parseInt(document.getElementById('statsYearSelect').value);
            
            const myBookings = bookings.filter(b => {
                if (b.renterId !== currentUser.id || b.status !== 'active') return false;
                const bookingDate = new Date(b.date);
                return bookingDate.getMonth() === month && bookingDate.getFullYear() === year;
            });
            
            // 計算統計數據 | Calculate statistics
            let totalHours = 0;
            let totalAmount = 0;
            
            myBookings.forEach(b => {
                const start = b.startTime.split(':').map(Number);
                const end = b.endTime.split(':').map(Number);
                const hours = (end[0] * 60 + end[1] - start[0] * 60 - start[1]) / 60;
                totalHours += hours;
                totalAmount += b.totalPrice;
            });
            
            document.getElementById('statsBookingCount').textContent = myBookings.length;
            document.getElementById('statsTotalHours').textContent = totalHours.toFixed(1);
            document.getElementById('statsTotalAmount').textContent = `$${totalAmount}`;
            
            // 渲染詳細信息 | Render details
            const detailsContainer = document.getElementById('statsBookingDetails');
            const noStatsMessage = document.getElementById('noStatsMessage');
            
            if (myBookings.length === 0) {
                detailsContainer.innerHTML = '';
                noStatsMessage.classList.remove('hidden');
                return;
            }
            
            noStatsMessage.classList.add('hidden');
            
            const branchNames = { 
                jordan: 'Jordan / 佐敦', 
                wanchai: 'Wan Chai / 灣仔', 
                tsuenwan: 'Tsuen Wan / 荃灣' 
            };
            
            myBookings.sort((a, b) => a.date.localeCompare(b.date));
            
            detailsContainer.innerHTML = myBookings.map(b => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div>
                        <p class="font-medium text-gray-800">${b.roomName} - ${branchNames[b.branch]}</p>
                        <p class="text-sm text-gray-500">${b.date} | ${b.startTime} - ${b.endTime}</p>
                        ${b.toyRental ? '<div class="bilingual-text mt-1"><span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded">+ Toy / 玩具</span></div>' : ''}
                    </div>
                    <p class="font-semibold text-gray-800">$${b.totalPrice}</p>
                </div>
            `).join('');
        }
        
        // ============ 職員：租用者管理 | Staff: Renters Management ============
        function renderRentersList() {
            const container = document.getElementById('rentersList');
            const noRentersMessage = document.getElementById('noRentersMessage');
            
            if (renters.length === 0) {
                container.innerHTML = '';
                noRentersMessage.classList.remove('hidden');
                return;
            }
            
            noRentersMessage.classList.add('hidden');
            
            container.innerHTML = renters.map(renter => {
                const renterBookings = bookings.filter(b => b.renterId === renter.id && b.status === 'active');
                const totalSpent = renterBookings.reduce((sum, b) => sum + b.totalPrice, 0);
                
                return `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-slate-200 rounded-xl flex items-center justify-center">
                                <span class="text-xl font-bold text-slate-600">${renter.name.split('/')[0].trim().charAt(0).toUpperCase()}</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">${renter.name}</p>
                                <p class="text-sm text-gray-500">${renter.email || 'No email / 無電郵'} | ${renter.phone || 'No phone / 無電話'}</p>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">Password / 密碼: ${renter.password}</span>
                                    <span class="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded">Bookings / 預約: ${renterBookings.length}</span>
                                    <span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded">Total / 總計: $${totalSpent}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="editRenter('${renter.id}')" class="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-lg transition">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteRenter('${renter.id}')" class="p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            // 更新篩選下拉菜單 | Update filter dropdown
            const filterSelect = document.getElementById('staffBookingFilter');
            filterSelect.innerHTML = '<option value="all">All Renters / 所有租用者</option>';
            renters.forEach(r => {
                filterSelect.innerHTML += `<option value="${r.id}">${r.name}</option>`;
            });
        }
        
        function showAddRenterModal() {
            document.getElementById('addRenterModal').classList.remove('hidden');
            document.getElementById('newRenterName').value = '';
            document.getElementById('newRenterPassword').value = '';
            document.getElementById('newRenterEmail').value = '';
            document.getElementById('newRenterPhone').value = '';
            document.getElementById('addRenterError').classList.add('hidden');
        }
        
        function closeAddRenterModal() {
            document.getElementById('addRenterModal').classList.add('hidden');
        }
        
        async function addRenter() {
            const name = document.getElementById('newRenterName').value.trim();
            const password = document.getElementById('newRenterPassword').value;
            const email = document.getElementById('newRenterEmail').value.trim();
            const phone = document.getElementById('newRenterPhone').value.trim();
            
            if (!name || !password) {
                document.getElementById('addRenterError').textContent = 'Name and password are required / 姓名和密碼為必填';
                document.getElementById('addRenterError').classList.remove('hidden');
                return;
            }
            
            // 檢查重複姓名 | Check for duplicate name
            if (renters.some(r => {
                const names = r.name.split('/').map(n => n.trim());
                return names[0].toLowerCase() === name.toLowerCase();
            })) {
                document.getElementById('addRenterError').textContent = 'Renter name already exists / 租用者姓名已存在';
                document.getElementById('addRenterError').classList.remove('hidden');
                return;
            }
            
            const btn = document.getElementById('addRenterBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="bilingual-text items-center"><div class="english english-font">Adding...</div><div class="chinese chinese-font text-xs">新增中...</div></div>';
            
            // 模擬API延遲 | Simulate API delay
            setTimeout(() => {
                const newRenter = {
                    id: generateId(),
                    name: name,
                    password: password,
                    email: email,
                    phone: phone,
                    createdAt: new Date().toISOString()
                };
                
                renters.push(newRenter);
                saveData('renters', renters);
                
                btn.disabled = false;
                btn.innerHTML = '<div class="bilingual-text items-center"><div class="english english-font">Add</div><div class="chinese chinese-font text-xs">新增</div></div>';
                
                showToast('Renter added successfully / 租用者已新增', 'success');
                closeAddRenterModal();
                renderRentersList();
                updateReceiptRenterSelect();
            }, 500);
        }
        
        function editRenter(renterId) {
            const renter = renters.find(r => r.id === renterId);
            if (!renter) return;
            
            document.getElementById('editRenterId').value = renterId;
            document.getElementById('editRenterName').value = renter.name;
            document.getElementById('editRenterPassword').value = renter.password;
            document.getElementById('editRenterEmail').value = renter.email || '';
            document.getElementById('editRenterPhone').value = renter.phone || '';
            document.getElementById('editRenterError').classList.add('hidden');
            document.getElementById('editRenterModal').classList.remove('hidden');
        }
        
        function closeEditRenterModal() {
            document.getElementById('editRenterModal').classList.add('hidden');
        }
        
        async function saveRenterEdit() {
            const renterId = document.getElementById('editRenterId').value;
            const name = document.getElementById('editRenterName').value.trim();
            const password = document.getElementById('editRenterPassword').value;
            const email = document.getElementById('editRenterEmail').value.trim();
            const phone = document.getElementById('editRenterPhone').value.trim();
            
            if (!name || !password) {
                document.getElementById('editRenterError').textContent = 'Name and password are required / 姓名和密碼為必填';
                document.getElementById('editRenterError').classList.remove('hidden');
                return;
            }
            
            const renterIndex = renters.findIndex(r => r.id === renterId);
            if (renterIndex === -1) return;
            
            const btn = document.getElementById('saveRenterBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="bilingual-text items-center"><div class="english english-font">Saving...</div><div class="chinese chinese-font text-xs">儲存中...</div></div>';
            
            // 模擬API延遲 | Simulate API delay
            setTimeout(() => {
                renters[renterIndex] = {
                    ...renters[renterIndex],
                    name: name,
                    password: password,
                    email: email,
                    phone: phone
                };
                
                saveData('renters', renters);
                
                btn.disabled = false;
                btn.innerHTML = '<div class="bilingual-text items-center"><div class="english english-font">Save</div><div class="chinese chinese-font text-xs">儲存</div></div>';
                
                showToast('Renter updated / 租用者已更新', 'success');
                closeEditRenterModal();
                renderRentersList();
                updateReceiptRenterSelect();
            }, 500);
        }
        
        async function deleteRenter(renterId) {
            const renter = renters.find(r => r.id === renterId);
            if (!renter) return;
            
            if (!confirm(`Delete "${renter.name}"? / 刪除「${renter.name}」？`)) return;
            
            // 刪除租用者的所有預約 | Delete all bookings of the renter
            bookings = bookings.filter(b => b.renterId !== renterId);
            saveData('bookings', bookings);
            
            // 刪除租用者 | Delete renter
            renters = renters.filter(r => r.id !== renterId);
            saveData('renters', renters);
            
            showToast('Renter deleted / 租用者已刪除', 'success');
            renderRentersList();
            updateReceiptRenterSelect();
        }
        
        // ============ 職員：房間設定 | Staff: Room Settings ============
        function renderRoomSettings() {
            const branches = { 
                jordan: 'jordanRooms', 
                wanchai: 'wanchaiRooms', 
                tsuenwan: 'tsuenwanRooms' 
            };
            
            for (const branch in branches) {
                const container = document.getElementById(branches[branch]);
                container.innerHTML = defaultRooms[branch].map(room => {
                    const savedPrice = roomPrices.find(p => p.roomId === room.id);
                    const currentPrice = savedPrice ? savedPrice.price : room.price;
                    const currentToyPrice = savedPrice ? savedPrice.toyPricePerHour : room.toyPricePerHour;
                    const pricePerHour = currentPrice * 2;
                    
                    return `
                        <div class="room-card p-4 bg-gray-50 rounded-xl">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-medium text-gray-800">${room.name}</h4>
                                <span class="text-xs text-gray-500">${room.facilities}</span>
                            </div>
                            <div class="flex items-center gap-2 mb-2">
                                <label class="text-sm text-gray-600">Price / 租金/hr:</label>
                                <input type="number" value="${pricePerHour}" 
                                    onchange="updateRoomPrice('${room.id}', this.value / 2, ${currentToyPrice})"
                                    class="w-24 px-3 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            ${room.toyAvailable ? `
                                <div class="flex items-center gap-2">
                                    <label class="text-sm text-gray-600">Toy / 玩具/hr:</label>
                                    <input type="number" value="${currentToyPrice}" 
                                        onchange="updateRoomPrice('${room.id}', ${currentPrice}, this.value)"
                                        class="w-24 px-3 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            }
        }
        
        async function updateRoomPrice(roomId, price, toyPrice) {
            const existingPriceIndex = roomPrices.findIndex(p => p.roomId === roomId);
            
            // 獲取房間信息 | Get room information
            let roomBranch = '';
            let roomInfo = null;
            for (const branch in defaultRooms) {
                const found = defaultRooms[branch].find(r => r.id === roomId);
                if (found) {
                    roomBranch = branch;
                    roomInfo = found;
                    break;
                }
            }
            
            if (existingPriceIndex !== -1) {
                roomPrices[existingPriceIndex] = {
                    ...roomPrices[existingPriceIndex],
                    price: parseFloat(price),
                    toyPricePerHour: parseFloat(toyPrice)
                };
            } else {
                roomPrices.push({
                    id: generateId(),
                    roomId: roomId,
                    roomName: roomInfo.name,
                    branch: roomBranch,
                    price: parseFloat(price),
                    facilities: roomInfo.facilities,
                    toyAvailable: roomInfo.toyAvailable,
                    toyPricePerHour: parseFloat(toyPrice)
                });
            }
            
            saveData('roomPrices', roomPrices);
            showToast('Price updated / 價格已更新', 'success');
        }
        
        // ============ 職員：所有預約 | Staff: All Bookings ============
        function renderAllBookings() {
            filterStaffBookings();
        }
        
        function filterStaffBookings() {
            const renterFilter = document.getElementById('staffBookingFilter').value;
            const branchFilter = document.getElementById('staffBranchFilter').value;
            
            let filteredBookings = bookings.filter(b => b.status === 'active');
            
            if (renterFilter !== 'all') {
                filteredBookings = filteredBookings.filter(b => b.renterId === renterFilter);
            }
            
            if (branchFilter !== 'all') {
                filteredBookings = filteredBookings.filter(b => b.branch === branchFilter);
            }
            
            // 按日期排序 | Sort by date
            filteredBookings.sort((a, b) => {
                if (a.date !== b.date) return b.date.localeCompare(a.date);
                return b.startTime.localeCompare(a.startTime);
            });
            
            const container = document.getElementById('allBookingsList');
            const noAllBookingsMessage = document.getElementById('noAllBookingsMessage');
            const branchNames = { 
                jordan: 'Jordan / 佐敦', 
                wanchai: 'Wan Chai / 灣仔', 
                tsuenwan: 'Tsuen Wan / 荃灣' 
            };
            
            if (filteredBookings.length === 0) {
                container.innerHTML = '';
                noAllBookingsMessage.classList.remove('hidden');
                return;
            }
            
            noAllBookingsMessage.classList.add('hidden');
            
            container.innerHTML = filteredBookings.map(b => {
                const start = b.startTime.split(':').map(Number);
                const end = b.endTime.split(':').map(Number);
                const hours = (end[0] * 60 + end[1] - start[0] * 60 - start[1]) / 60;
                
                return `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 ${b.branch === 'jordan' ? 'bg-blue-200' : b.branch === 'wanchai' ? 'bg-green-200' : 'bg-purple-200'} rounded-xl flex items-center justify-center">
                                <span class="text-xl font-bold ${b.branch === 'jordan' ? 'text-blue-600' : b.branch === 'wanchai' ? 'text-green-600' : 'text-purple-600'}">${b.renterName.split('/')[0].trim().charAt(0).toUpperCase()}</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">${b.renterName}</p>
                                <p class="text-sm text-gray-600">${b.roomName} - ${branchNames[b.branch]}</p>
                                <p class="text-sm text-gray-500">${b.date} | ${b.startTime} - ${b.endTime} (${hours.toFixed(1)} hrs)</p>
                                ${b.toyRental ? '<div class="bilingual-text mt-1"><span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded">+ Toy / 玩具</span></div>' : ''}
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-gray-800">$${b.totalPrice}</p>
                            <button onclick="cancelBookingByStaff('${b.id}')" class="text-sm text-red-500 hover:text-red-700 mt-1">
                                Cancel / 取消
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        async function cancelBookingByStaff(bookingId) {
            const bookingIndex = bookings.findIndex(b => b.id === bookingId);
            if (bookingIndex === -1) return;
            
            if (!confirm(`Cancel booking for ${bookings[bookingIndex].renterName}? / 取消${bookings[bookingIndex].renterName}的預約？`)) return;
            
            bookings[bookingIndex].status = 'cancelled';
            saveData('bookings', bookings);
            
            showToast('Booking cancelled / 預約已取消', 'success');
            renderAllBookings();
            generateReport();
        }
        
        // ============ 職員：報表 | Staff: Reports ============
        function generateReport() {
            const month = parseInt(document.getElementById('reportMonthSelect').value);
            const year = parseInt(document.getElementById('reportYearSelect').value);
            
            const monthBookings = bookings.filter(b => {
                const bookingDate = new Date(b.date);
                return bookingDate.getMonth() === month && bookingDate.getFullYear() === year && b.status === 'active';
            });
            
            // 計算總數 | Calculate totals
            let totalHours = 0;
            let totalRevenue = 0;
            const activeRenterIds = new Set();
            
            monthBookings.forEach(b => {
                const start = b.startTime.split(':').map(Number);
                const end = b.endTime.split(':').map(Number);
                const hours = (end[0] * 60 + end[1] - start[0] * 60 - start[1]) / 60;
                totalHours += hours;
                totalRevenue += b.totalPrice;
                activeRenterIds.add(b.renterId);
            });
            
            document.getElementById('reportTotalBookings').textContent = monthBookings.length;
            document.getElementById('reportTotalHours').textContent = totalHours.toFixed(1);
            document.getElementById('reportTotalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
            document.getElementById('reportActiveRenters').textContent = activeRenterIds.size;
            
            // 設置列印信息 | Set print information
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const chineseMonths = ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];
            document.getElementById('printReportPeriod').textContent = `${months[month]} ${year} / ${chineseMonths[month]} ${year}`;
            document.getElementById('printGeneratedDate').textContent = `${new Date().toLocaleDateString('en-US')} / ${new Date().toLocaleDateString('zh-HK')}`;
            
            // 按租用者分類 | Breakdown by renter
            const renterBreakdown = {};
            monthBookings.forEach(b => {
                if (!renterBreakdown[b.renterId]) {
                    renterBreakdown[b.renterId] = {
                        name: b.renterName,
                        bookings: [],
                        totalHours: 0,
                        totalAmount: 0
                    };
                }
                
                const start = b.startTime.split(':').map(Number);
                const end = b.endTime.split(':').map(Number);
                const hours = (end[0] * 60 + end[1] - start[0] * 60 - start[1]) / 60;
                
                renterBreakdown[b.renterId].bookings.push(b);
                renterBreakdown[b.renterId].totalHours += hours;
                renterBreakdown[b.renterId].totalAmount += b.totalPrice;
            });
            
            const branchNames = { 
                jordan: 'Jordan / 佐敦', 
                wanchai: 'Wan Chai / 灣仔', 
                tsuenwan: 'Tsuen Wan / 荃灣' 
            };
            const container = document.getElementById('reportByRenter');
            const noReportMessage = document.getElementById('noReportMessage');
            
            if (Object.keys(renterBreakdown).length === 0) {
                container.innerHTML = '';
                noReportMessage.classList.remove('hidden');
                return;
            }
            
            noReportMessage.classList.add('hidden');
            
            container.innerHTML = Object.values(renterBreakdown).map(renter => `
                <div class="border border-gray-200 rounded-xl overflow-hidden print-border">
                    <div class="bg-slate-50 px-4 py-3 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-slate-200 rounded-lg flex items-center justify-center">
                                <span class="font-bold text-slate-600">${renter.name.split('/')[0].trim().charAt(0).toUpperCase()}</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">${renter.name}</p>
                                <p class="text-sm text-gray-500">${renter.bookings.length} bookings / 預約 | ${renter.totalHours.toFixed(1)} hrs / 小時</p>
                            </div>
                        </div>
                        <p class="text-xl font-bold text-slate-800">$${renter.totalAmount.toFixed(2)}</p>
                    </div>
                    <div class="p-4 space-y-2">
                        ${renter.bookings.sort((a, b) => a.date.localeCompare(b.date)).map(b => `
                            <div class="flex items-center justify-between text-sm p-2 bg-gray-50 rounded-lg">
                                <div>
                                    <span class="text-gray-800">${b.date}</span>
                                    <span class="text-gray-500 mx-2">|</span>
                                    <span class="text-gray-600">${b.startTime}-${b.endTime}</span>
                                </div>
                                <div class="text-right">
                                    <span class="text-gray-600">${b.roomName} (${branchNames[b.branch].split('/')[0].trim()})</span>
                                    <span class="text-gray-800 font-medium ml-2">$${b.totalPrice.toFixed(2)}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        function printReport() {
            // 顯示列印元素 | Show print elements
            document.querySelectorAll('.print-header, .print-footer').forEach(el => {
                el.classList.remove('hidden');
            });
            
            // 設置頁碼 | Set page numbers
            document.querySelectorAll('.page-number').forEach((el, index) => {
                el.textContent = index + 1;
            });
            
            window.print();
            
            // 隱藏列印元素 | Hide print elements
            setTimeout(() => {
                document.querySelectorAll('.print-header, .print-footer').forEach(el => {
                    el.classList.add('hidden');
                });
            }, 100);
        }
        
        // ============ 職員：收據 | Staff: Receipts ============
        function updateReceiptRenterSelect() {
            const select = document.getElementById('receiptRenterSelect');
            select.innerHTML = '<option value="">Select Renter / 選擇租用者</option>';
            renters.forEach(r => {
                select.innerHTML += `<option value="${r.id}">${r.name}</option>`;
            });
        }
        
        function generateReceipt() {
            const renterId = document.getElementById('receiptRenterSelect').value;
            const month = parseInt(document.getElementById('reportMonthSelect').value);
            const year = parseInt(document.getElementById('reportYearSelect').value);
            
            if (!renterId) {
                showToast('Please select a renter / 請選擇租用者', 'error');
                return;
            }
            
            const renter = renters.find(r => r.id === renterId);
            if (!renter) return;
            
            const renterBookings = bookings.filter(b => {
                if (b.renterId !== renterId || b.status !== 'active') return false;
                const bookingDate = new Date(b.date);
                return bookingDate.getMonth() === month && bookingDate.getFullYear() === year;
            });
            
            let totalAmount = 0;
            let totalHours = 0;
            
            renterBookings.forEach(b => {
                totalAmount += b.totalPrice;
                const start = b.startTime.split(':').map(Number);
                const end = b.endTime.split(':').map(Number);
                totalHours += (end[0] * 60 + end[1] - start[0] * 60 - start[1]) / 60;
            });
            
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const chineseMonths = ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];
            const branchNames = { 
                jordan: 'Jordan / 佐敦', 
                wanchai: 'Wan Chai / 灣仔', 
                tsuenwan: 'Tsuen Wan / 荃灣' 
            };
            
            const preview = document.getElementById('receiptPreview');
            preview.classList.remove('hidden');
            preview.innerHTML = `
                <div class="max-w-md mx-auto">
                    <!-- 收據表頭 | Receipt Header -->
                    <div class="text-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800 english-font">Counselling Room Rental Receipt</h2>
                        <h3 class="text-lg text-gray-600 chinese-font">心理輔導室租用收據</h3>
                        <p class="text-gray-500 mt-2">${months[month]} ${year} / ${chineseMonths[month]} ${year}</p>
                    </div>
                    
                    <!-- 租用者信息 | Renter Information -->
                    <div class="mb-6 pb-4 border-b border-gray-200">
                        <div class="bilingual-text">
                            <div class="english english-font text-gray-600">Renter:</div>
                            <div class="chinese chinese-font text-gray-600">租用者:</div>
                        </div>
                        <p class="font-semibold text-gray-800 text-lg">${renter.name}</p>
                        ${renter.email ? `<p class="text-sm text-gray-500">${renter.email}</p>` : ''}
                        ${renter.phone ? `<p class="text-sm text-gray-500">${renter.phone}</p>` : ''}
                    </div>
                    
                    <!-- 預約詳情 | Booking Details -->
                    <div class="mb-6">
                        <div class="bilingual-text mb-3">
                            <div class="english english-font font-semibold text-gray-800">Booking Details</div>
                            <div class="chinese chinese-font font-semibold text-gray-800">預約詳情</div>
                        </div>
                        
                        ${renterBookings.length === 0 ? 
                            '<div class="text-center py-4"><p class="text-gray-500 english-font">No bookings this month</p><p class="text-gray-500 chinese-font">本月無預約記錄</p></div>' :
                            renterBookings.sort((a, b) => a.date.localeCompare(b.date)).map(b => `
                                <div class="flex justify-between py-2 border-b border-gray-100 text-sm">
                                    <div>
                                        <p class="text-gray-800">${b.date}</p>
                                        <p class="text-gray-500">${b.roomName} (${branchNames[b.branch].split('/')[0].trim()}) ${b.startTime}-${b.endTime}</p>
                                        ${b.toyRental ? '<div class="bilingual-text"><p class="text-xs text-yellow-600 english-font">+ Toy Rental</p><p class="text-xs text-yellow-600 chinese-font">+ 玩具租用</p></div>' : ''}
                                    </div>
                                    <p class="font-medium text-gray-800">$${b.totalPrice.toFixed(2)}</p>
                                </div>
                            `).join('')
                        }
                    </div>
                    
                    <!-- 總結 | Summary -->
                    <div class="bg-slate-50 rounded-lg p-4 mt-4">
                        <div class="flex justify-between mb-2">
                            <div class="bilingual-text">
                                <div class="english english-font text-gray-600">Total Hours:</div>
                                <div class="chinese chinese-font text-gray-600">總時數:</div>
                            </div>
                            <span class="font-medium text-gray-800">${totalHours.toFixed(1)} hrs</span>
                        </div>
                        <div class="flex justify-between text-lg font-bold pt-2 border-t border-gray-200">
                            <div class="bilingual-text">
                                <div class="english english-font text-slate-800">Total Amount:</div>
                                <div class="chinese chinese-font text-slate-800">總金額:</div>
                            </div>
                            <span class="text-slate-800">$${totalAmount.toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <!-- 收據表尾 | Receipt Footer -->
                    <div class="mt-8 pt-4 border-t border-gray-200 text-xs text-gray-500">
                        <div class="bilingual-text">
                            <div class="english english-font">Receipt generated on ${new Date().toLocaleDateString('en-US')}</div>
                            <div class="chinese chinese-font">收據生成日期: ${new Date().toLocaleDateString('zh-HK')}</div>
                        </div>
                        <div class="bilingual-text mt-2">
                            <div class="english english-font">This is an official receipt for room rental services.</div>
                            <div class="chinese chinese-font">此為房間租用服務正式收據。</div>
                        </div>
                    </div>
                    
                    <!-- 列印按鈕 | Print Button -->
                    <div class="mt-6 text-center no-print">
                        <button onclick="printReceipt()" class="px-6 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 transition">
                            <i class="fas fa-print mr-2"></i>
                            <span class="english-font">Print Receipt</span>
                            <span class="chinese-font ml-2">列印收據</span>
                        </button>
                    </div>
                </div>
            `;
        }
        
        function printReceipt() {
            const receiptContent = document.getElementById('receiptPreview').innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = receiptContent;
            window.print();
            document.body.innerHTML = originalContent;
            
            // 重新初始化應用 | Reinitialize application
            initApp();
            if (isStaff) {
                document.getElementById('staffDashboard').classList.remove('hidden');
            } else if (currentUser) {
                document.getElementById('renterDashboard').classList.remove('hidden');
            } else {
                document.getElementById('loginScreen').classList.remove('hidden');
            }
        }
        
        // ============ 工具函數 | Utility Functions ============
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'}`;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }
        
        // ============ 應用初始化 | Application Initialization ============
        window.onload = function() {
            initApp();
        };
    </script>
</body>
</html>
