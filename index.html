<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心理學家房間預約系統 | Psychologist Room Booking System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        }
        
        :root {
            --primary: #4a6fa5;
            --secondary: #166088;
            --accent: #ff7e5f;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 語言切換 */
        .lang-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .lang-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* 標題樣式 */
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        /* 登入區域 */
        .login-section, .main-section {
            display: none;
        }
        
        .active-section {
            display: block;
        }
        
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            max-width: 500px;
            margin: 0 auto;
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }
        
        .btn {
            display: inline-block;
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn-logout {
            background: var(--danger);
            margin-top: 20px;
        }
        
        .btn-logout:hover {
            background: #c82333;
        }
        
        /* 分頁樣式 */
        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .tab-btn:hover {
            color: var(--primary);
        }
        
        .tab-btn.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }
        
        /* 房間選擇 */
        .branch-selector {
            margin-bottom: 30px;
        }
        
        .branch-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .branch-btn {
            flex: 1;
            min-width: 200px;
        }
        
        .room-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .room-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }
        
        .room-card:hover {
            transform: translateY(-5px);
        }
        
        .room-header {
            background: var(--primary);
            color: white;
            padding: 20px;
        }
        
        .room-title {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .room-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffd166;
        }
        
        .room-body {
            padding: 20px;
        }
        
        .room-facility {
            margin-bottom: 15px;
            color: var(--gray);
        }
        
        .room-facility i {
            color: var(--primary);
            margin-right: 8px;
        }
        
        /* 日曆樣式 */
        .calendar-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-month {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .calendar-nav button {
            background: var(--light-gray);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            color: var(--dark);
            transition: all 0.3s ease;
        }
        
        .calendar-nav button:hover {
            background: var(--primary);
            color: white;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--gray);
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day {
            height: 100px;
            background: var(--light);
            border-radius: 5px;
            padding: 10px;
            overflow-y: auto;
            border: 1px solid #eee;
        }
        
        .calendar-day.other-month {
            background: #f8f9fa;
            color: #ccc;
        }
        
        .calendar-day.today {
            background: #e8f4fd;
            border-color: var(--primary);
        }
        
        .day-number {
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .time-slot {
            font-size: 12px;
            background: var(--success);
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            margin-bottom: 3px;
            display: inline-block;
        }
        
        /* 時間選擇 */
        .time-slots-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .time-slot-btn {
            background: var(--light);
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 12px 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .time-slot-btn:hover {
            background: #e2e6ea;
        }
        
        .time-slot-btn.booked {
            background: #f8d7da;
            color: #721c24;
            cursor: not-allowed;
            border-color: #f5c6cb;
        }
        
        .time-slot-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* 統計區域 */
        .stats-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .month-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .stat-card {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }
        
        /* 預約列表 */
        .bookings-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .booking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .booking-item:last-child {
            border-bottom: none;
        }
        
        .booking-details h4 {
            margin-bottom: 5px;
        }
        
        .booking-actions button {
            margin-left: 10px;
        }
        
        /* 工作人員區域 */
        .admin-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .admin-panel {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .user-list, .booking-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .user-item, .booking-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        
        .user-header, .booking-header {
            font-weight: 700;
            background: var(--light);
        }
        
        /* 列印樣式 */
        @media print {
            .no-print, .lang-switcher, .tabs, .btn {
                display: none !important;
            }
            
            .container {
                width: 100%;
                max-width: 100%;
            }
            
            .admin-panel, .stats-container, .calendar-container {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        /* 響應式設計 */
        @media (max-width: 768px) {
            .room-grid {
                grid-template-columns: 1fr;
            }
            
            .branch-buttons {
                flex-direction: column;
            }
            
            .calendar-day {
                height: 80px;
            }
            
            .admin-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- 語言切換 -->
    <div class="lang-switcher">
        <button class="lang-btn" id="langToggle">
            <i class="fas fa-language"></i>
            <span id="currentLang">EN</span>
        </button>
    </div>
    
    <div class="container">
        <!-- 標題 -->
        <header>
            <h1 id="mainTitle">心理學家房間預約系統</h1>
            <p class="subtitle" id="subTitle">Psychologist Room Booking System</p>
        </header>
        
        <!-- 登入區域 -->
        <section id="loginSection" class="login-section active-section">
            <div class="login-container">
                <h2 class="login-title" id="loginTitle">租用者登入</h2>
                <div class="form-group">
                    <label for="username" id="usernameLabel">姓名 / Name:</label>
                    <input type="text" id="username" placeholder="請輸入您的姓名 / Enter your name">
                </div>
                <div class="form-group">
                    <label for="password" id="passwordLabel">密碼 / Password:</label>
                    <input type="password" id="password" placeholder="請輸入您的密碼 / Enter your password">
                </div>
                <button class="btn btn-block" id="loginBtn">登入 / Login</button>
                <div style="text-align: center; margin-top: 20px;">
                    <p id="staffLoginPrompt">工作人員請使用管理員帳號登入 / Staff please use admin account</p>
                    <button class="btn" id="staffLoginBtn" style="margin-top: 10px;">工作人員登入 / Staff Login</button>
                </div>
            </div>
        </section>
        
        <!-- 租用者主區域 -->
        <section id="userSection" class="main-section">
            <div class="tabs">
                <button class="tab-btn active" data-tab="booking" id="tabBooking">預約房間 / Book Room</button>
                <button class="tab-btn" data-tab="stats" id="tabStats">租用統計 / Booking Stats</button>
                <button class="tab-btn" data-tab="mybookings" id="tabMyBookings">我的預約 / My Bookings</button>
            </div>
            
            <!-- 預約房間分頁 -->
            <div id="bookingTab" class="tab-content active-section">
                <!-- 分店選擇 -->
                <div class="branch-selector">
                    <h3 id="branchTitle">選擇分店 / Select Branch</h3>
                    <div class="branch-buttons">
                        <button class="btn branch-btn" data-branch="Jordan">佐敦 / Jordan</button>
                        <button class="btn branch-btn" data-branch="WanChai">灣仔 / Wan Chai</button>
                        <button class="btn branch-btn" data-branch="TsuenWan">荃灣 / Tsuen Wan</button>
                    </div>
                </div>
                
                <!-- 房間選擇 -->
                <div id="roomsContainer">
                    <!-- 房間卡片將由JavaScript動態生成 -->
                </div>
                
                <!-- 日曆 -->
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="btn" id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                        <h2 class="calendar-month" id="currentMonth">2023年11月</h2>
                        <button class="btn" id="nextMonth"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div class="calendar-weekdays">
                        <div>日 / Sun</div>
                        <div>一 / Mon</div>
                        <div>二 / Tue</div>
                        <div>三 / Wed</div>
                        <div>四 / Thu</div>
                        <div>五 / Fri</div>
                        <div>六 / Sat</div>
                    </div>
                    <div class="calendar-days" id="calendarDays">
                        <!-- 日曆天數將由JavaScript動態生成 -->
                    </div>
                </div>
                
                <!-- 時間選擇 -->
                <div class="time-slots-container">
                    <h3 id="timeTitle">選擇時間 / Select Time</h3>
                    <p id="selectedDateInfo">請選擇一個日期 / Please select a date</p>
                    <div class="time-slots" id="timeSlots">
                        <!-- 時間段將由JavaScript動態生成 -->
                    </div>
                    <div id="toyOption" style="display: none; margin-top: 20px;">
                        <label>
                            <input type="checkbox" id="toyRental">
                            <span id="toyLabel">租用玩具 / Rent Toys (+$<span id="toyPrice">50</span>/小時 per hour)</span>
                        </label>
                    </div>
                    <button class="btn btn-block" id="confirmBooking" style="margin-top: 20px;" disabled>確認預約 / Confirm Booking</button>
                </div>
            </div>
            
            <!-- 租用統計分頁 -->
            <div id="statsTab" class="tab-content">
                <div class="stats-container">
                    <h3 id="statsTitle">租用統計 / Booking Statistics</h3>
                    <div class="month-selector">
                        <label for="statsMonth" id="statsMonthLabel">選擇月份 / Select Month:</label>
                        <input type="month" id="statsMonth" value="2023-11">
                        <button class="btn" id="viewStats">查看 / View</button>
                    </div>
                    <div class="stats-grid" id="statsGrid">
                        <!-- 統計數據將由JavaScript動態生成 -->
                    </div>
                </div>
            </div>
            
            <!-- 我的預約分頁 -->
            <div id="mybookingsTab" class="tab-content">
                <div class="bookings-container">
                    <h3 id="myBookingsTitle">我的預約 / My Bookings</h3>
                    <div id="userBookingsList">
                        <!-- 用戶預約列表將由JavaScript動態生成 -->
                    </div>
                </div>
            </div>
            
            <button class="btn btn-logout btn-block" id="logoutBtn">登出 / Logout</button>
        </section>
        
        <!-- 工作人員主區域 -->
        <section id="adminSection" class="main-section">
            <h2 id="adminTitle">工作人員管理系統 / Staff Management System</h2>
            
            <!-- 控制按鈕 -->
            <div class="admin-controls">
                <button class="btn" id="manageUsersBtn" data-tab="users">管理租用者 / Manage Users</button>
                <button class="btn" id="manageRoomsBtn" data-tab="rooms">管理房間 / Manage Rooms</button>
                <button class="btn" id="viewAllBookingsBtn" data-tab="allbookings">所有預約 / All Bookings</button>
                <button class="btn" id="printReportBtn">列印報告 / Print Report</button>
            </div>
            
            <!-- 管理租用者 -->
            <div id="usersTab" class="admin-panel tab-content active-section">
                <h3 id="manageUsersTitle">管理租用者 / Manage Users</h3>
                <button class="btn" id="addUserBtn" style="margin-bottom: 15px;">新增租用者 / Add User</button>
                <div class="user-list">
                    <div class="user-item user-header">
                        <div>姓名 / Name</div>
                        <div>聯絡電話 / Phone</div>
                        <div>電子郵件 / Email</div>
                        <div>密碼 / Password</div>
                        <div>操作 / Actions</div>
                    </div>
                    <div id="usersList">
                        <!-- 用戶列表將由JavaScript動態生成 -->
                    </div>
                </div>
            </div>
            
            <!-- 管理房間 -->
            <div id="roomsTab" class="admin-panel tab-content">
                <h3 id="manageRoomsTitle">管理房間 / Manage Rooms</h3>
                <div class="room-grid">
                    <!-- 房間卡片將由JavaScript動態生成 -->
                </div>
            </div>
            
            <!-- 所有預約 -->
            <div id="allbookingsTab" class="admin-panel tab-content">
                <h3 id="allBookingsTitle">所有預約 / All Bookings</h3>
                <div class="month-selector">
                    <label for="adminMonth" id="adminMonthLabel">選擇月份 / Select Month:</label>
                    <input type="month" id="adminMonth" value="2023-11">
                    <button class="btn" id="viewAdminBookings">查看 / View</button>
                </div>
                <div class="booking-list">
                    <div class="booking-row booking-header">
                        <div>租用者 / User</div>
                        <div>房間 / Room</div>
                        <div>日期 / Date</div>
                        <div>時間 / Time</div>
                        <div>租金 / Fee</div>
                        <div>操作 / Actions</div>
                    </div>
                    <div id="adminBookingsList">
                        <!-- 所有預約列表將由JavaScript動態生成 -->
                    </div>
                </div>
            </div>
            
            <button class="btn btn-logout btn-block" id="adminLogoutBtn">登出 / Logout</button>
        </section>
    </div>

    <script>
        // 語言設置 (繁體中文/英文)
        let currentLang = 'zh';
        const translations = {
            zh: {
                // 標題
                mainTitle: "心理學家房間預約系統",
                subTitle: "Psychologist Room Booking System",
                // 登入區域
                loginTitle: "租用者登入",
                usernameLabel: "姓名 / Name:",
                passwordLabel: "密碼 / Password:",
                loginBtn: "登入 / Login",
                staffLoginPrompt: "工作人員請使用管理員帳號登入 / Staff please use admin account",
                staffLoginBtn: "工作人員登入 / Staff Login",
                // 分頁
                tabBooking: "預約房間 / Book Room",
                tabStats: "租用統計 / Booking Stats",
                tabMyBookings: "我的預約 / My Bookings",
                // 預約區域
                branchTitle: "選擇分店 / Select Branch",
                timeTitle: "選擇時間 / Select Time",
                selectedDateInfo: "請選擇一個日期 / Please select a date",
                toyLabel: "租用玩具 / Rent Toys (+$",
                confirmBooking: "確認預約 / Confirm Booking",
                // 統計區域
                statsTitle: "租用統計 / Booking Statistics",
                statsMonthLabel: "選擇月份 / Select Month:",
                viewStats: "查看 / View",
                myBookingsTitle: "我的預約 / My Bookings",
                // 管理員區域
                adminTitle: "工作人員管理系統 / Staff Management System",
                manageUsersBtn: "管理租用者 / Manage Users",
                manageRoomsBtn: "管理房間 / Manage Rooms",
                viewAllBookingsBtn: "所有預約 / All Bookings",
                printReportBtn: "列印報告 / Print Report",
                manageUsersTitle: "管理租用者 / Manage Users",
                addUserBtn: "新增租用者 / Add User",
                manageRoomsTitle: "管理房間 / Manage Rooms",
                allBookingsTitle: "所有預約 / All Bookings",
                adminMonthLabel: "選擇月份 / Select Month:",
                viewAdminBookings: "查看 / View",
                // 其他
                logoutBtn: "登出 / Logout",
                // 房間狀態
                booked: "已預約",
                available: "可預約",
                select: "選擇",
                cancel: "取消",
                edit: "編輯",
                delete: "刪除",
                // 統計卡片
                totalHours: "總時數",
                totalSessions: "總次數",
                totalAmount: "總金額",
                averagePerSession: "平均每次"
            },
            en: {
                // Titles
                mainTitle: "Psychologist Room Booking System",
                subTitle: "心理學家房間預約系統",
                // Login area
                loginTitle: "User Login",
                usernameLabel: "Name / 姓名:",
                passwordLabel: "Password / 密碼:",
                loginBtn: "Login / 登入",
                staffLoginPrompt: "Staff please use admin account / 工作人員請使用管理員帳號登入",
                staffLoginBtn: "Staff Login / 工作人員登入",
                // Tabs
                tabBooking: "Book Room / 預約房間",
                tabStats: "Booking Stats / 租用統計",
                tabMyBookings: "My Bookings / 我的預約",
                // Booking area
                branchTitle: "Select Branch / 選擇分店",
                timeTitle: "Select Time / 選擇時間",
                selectedDateInfo: "Please select a date / 請選擇一個日期",
                toyLabel: "Rent Toys / 租用玩具 (+$",
                confirmBooking: "Confirm Booking / 確認預約",
                // Stats area
                statsTitle: "Booking Statistics / 租用統計",
                statsMonthLabel: "Select Month / 選擇月份:",
                viewStats: "View / 查看",
                myBookingsTitle: "My Bookings / 我的預約",
                // Admin area
                adminTitle: "Staff Management System / 工作人員管理系統",
                manageUsersBtn: "Manage Users / 管理租用者",
                manageRoomsBtn: "Manage Rooms / 管理房間",
                viewAllBookingsBtn: "All Bookings / 所有預約",
                printReportBtn: "Print Report / 列印報告",
                manageUsersTitle: "Manage Users / 管理租用者",
                addUserBtn: "Add User / 新增租用者",
                manageRoomsTitle: "Manage Rooms / 管理房間",
                allBookingsTitle: "All Bookings / 所有預約",
                adminMonthLabel: "Select Month / 選擇月份:",
                viewAdminBookings: "View / 查看",
                // Other
                logoutBtn: "Logout / 登出",
                // Room status
                booked: "Booked",
                available: "Available",
                select: "Select",
                cancel: "Cancel",
                edit: "Edit",
                delete: "Delete",
                // Stats cards
                totalHours: "Total Hours",
                totalSessions: "Total Sessions",
                totalAmount: "Total Amount",
                averagePerSession: "Average Per Session"
            }
        };

        // 初始化系統數據
        let currentUser = null;
        let currentAdmin = false;
        let selectedBranch = null;
        let selectedRoom = null;
        let selectedDate = null;
        let selectedTime = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        
        // 房間數據 (可從GitHub同步)
        const roomsData = {
            Jordan: [
                { id: "RoomC", name: "Room C", price: 140, facilities: ["催眠椅 / Hypnosis Chair"], hasToys: false },
                { id: "RoomD", name: "Room D", price: 190, facilities: ["小組 / Group", "沙盤遊戲治療 / Sandplay Therapy"], hasToys: true, toyPrice: 50 },
                { id: "RoomE", name: "Room E", price: 170, facilities: ["大房 / Large Room", "家庭治療 / Family Therapy"] },
                { id: "RoomF", name: "Room F", price: 150, facilities: ["落地窗輔導室 / Floor-to-Ceiling Window Counseling Room"] },
                { id: "RoomG", name: "Room G", price: 150, facilities: ["落地窗輔導室 / Floor-to-Ceiling Window Counseling Room"] }
            ],
            WanChai: [
                { id: "Room1", name: "Room 1", price: 160, facilities: ["窗口大房 / Large Window Room", "長梳化 / Long Sofa"] },
                { id: "Room2", name: "Room 2", price: 140, facilities: ["舒適輔導室 / Comfortable Counseling Room"] },
                { id: "Room3", name: "Room 3", price: 140, facilities: ["舒適輔導室 / Comfortable Counseling Room"] },
                { id: "Room4", name: "Room 4", price: 180, facilities: ["小組 / Group", "沙盤遊戲治療 / Sandplay Therapy"], hasToys: true, toyPrice: 40 }
            ],
            TsuenWan: [
                { id: "Room5", name: "Room 5", price: 130, facilities: [] },
                { id: "Room6", name: "Room 6", price: 140, facilities: [] },
                { id: "Room7", name: "Room 7", price: 140, facilities: [] },
                { id: "Room8", name: "Room 8", price: 160, facilities: ["大窗輔導室 / Large Window Counseling Room"] }
            ]
        };
        
        // 預約數據 (模擬數據庫)
        let bookingsData = [];
        let usersData = [
            { id: 1, name: "張醫生 / Dr. Zhang", phone: "9123-4567", email: "drzhang@example.com", password: "pass123" },
            { id: 2, name: "Dr. Smith", phone: "6234-5678", email: "drsmith@example.com", password: "pass456" },
            { id: 3, name: "陳輔導員 / Counselor Chen", phone: "9345-6789", email: "counselorchen@example.com", password: "pass789" }
        ];
        
        // 初始化一些預約數據
        function initSampleBookings() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            bookingsData = [
                { id: 1, userId: 1, userName: "張醫生 / Dr. Zhang", roomId: "RoomC", branch: "Jordan", date: formatDate(today), time: "09:00-09:30", duration: 0.5, price: 140, toyRental: false, total: 140 },
                { id: 2, userId: 1, userName: "張醫生 / Dr. Zhang", roomId: "RoomD", branch: "Jordan", date: formatDate(today), time: "10:00-11:00", duration: 1, price: 190, toyRental: true, total: 240 },
                { id: 3, userId: 2, userName: "Dr. Smith", roomId: "Room1", branch: "WanChai", date: formatDate(today), time: "14:00-15:00", duration: 1, price: 160, toyRental: false, total: 160 },
                { id: 4, userId: 3, userName: "陳輔導員 / Counselor Chen", roomId: "Room8", branch: "TsuenWan", date: formatDate(tomorrow), time: "11:00-12:00", duration: 1, price: 160, toyRental: false, total: 160 },
                { id: 5, userId: 1, userName: "張醫生 / Dr. Zhang", roomId: "RoomF", branch: "Jordan", date: formatDate(tomorrow), time: "15:00-16:00", duration: 1, price: 150, toyRental: false, total: 150 }
            ];
        }
        
        // 頁面加載時初始化
        document.addEventListener('DOMContentLoaded', function() {
            initSampleBookings();
            updateLanguage();
            setupEventListeners();
            
            // 初始化日曆
            renderCalendar();
            
            // 模擬從GitHub加載數據
            loadFromGitHub();
        });
        
        // 設置事件監聽器
        function setupEventListeners() {
            // 語言切換
            document.getElementById('langToggle').addEventListener('click', toggleLanguage);
            
            // 登入相關
            document.getElementById('loginBtn').addEventListener('click', userLogin);
            document.getElementById('staffLoginBtn').addEventListener('click', staffLogin);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('adminLogoutBtn').addEventListener('click', logout);
            
            // 分頁切換
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    switchTab(tab);
                });
            });
            
            // 管理員分頁切換
            document.querySelectorAll('.admin-controls .btn').forEach(btn => {
                if (btn.id !== 'printReportBtn') {
                    btn.addEventListener('click', function() {
                        const tab = this.getAttribute('data-tab');
                        switchAdminTab(tab);
                    });
                }
            });
            
            // 分店選擇
            document.querySelectorAll('.branch-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectedBranch = this.getAttribute('data-branch');
                    renderRooms(selectedBranch);
                    // 高亮選中的分店按鈕
                    document.querySelectorAll('.branch-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // 日曆導航
            document.getElementById('prevMonth').addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar();
            });
            
            document.getElementById('nextMonth').addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar();
            });
            
            // 預約確認
            document.getElementById('confirmBooking').addEventListener('click', confirmBooking);
            
            // 統計查看
            document.getElementById('viewStats').addEventListener('click', renderUserStats);
            
            // 管理員查看預約
            document.getElementById('viewAdminBookings').addEventListener('click', renderAdminBookings);
            
            // 新增用戶
            document.getElementById('addUserBtn').addEventListener('click', addNewUser);
            
            // 列印報告
            document.getElementById('printReportBtn').addEventListener('click', printReport);
            
            // 玩具租用選擇
            document.getElementById('toyRental').addEventListener('change', updateBookingPrice);
        }
        
        // 切換語言
        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateLanguage();
        }
        
        // 更新頁面語言
        function updateLanguage() {
            // 更新語言按鈕文本
            document.getElementById('currentLang').textContent = currentLang === 'zh' ? 'EN' : '中';
            
            // 更新所有翻譯文本
            for (const key in translations[currentLang]) {
                const elements = document.querySelectorAll(`[id="${key}"]`);
                elements.forEach(element => {
                    if (element.tagName === 'INPUT' && element.type !== 'button') {
                        element.placeholder = translations[currentLang][key];
                    } else {
                        element.textContent = translations[currentLang][key];
                    }
                });
            }
            
            // 更新房間設施文本
            renderRooms(selectedBranch);
            
            // 更新用戶統計
            if (document.getElementById('statsTab').classList.contains('active-section')) {
                renderUserStats();
            }
            
            // 更新用戶預約
            if (document.getElementById('mybookingsTab').classList.contains('active-section')) {
                renderUserBookings();
            }
            
            // 更新管理員預約
            if (document.getElementById('allbookingsTab').classList.contains('active-section')) {
                renderAdminBookings();
            }
        }
        
        // 租用者登入
        function userLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                alert(currentLang === 'zh' ? "請輸入姓名和密碼 / Please enter name and password" : "Please enter name and password / 請輸入姓名和密碼");
                return;
            }
            
            // 在用戶數據中查找
            const user = usersData.find(u => 
                u.name.includes(username) || username.includes(u.name.split(' / ')[0]) || username.includes(u.name.split(' / ')[1])
            );
            
            if (user && user.password === password) {
                currentUser = user;
                currentAdmin = false;
                showSection('userSection');
                renderUserBookings();
                renderUserStats();
            } else {
                alert(currentLang === 'zh' ? "登入失敗，請檢查姓名和密碼 / Login failed, please check name and password" : "Login failed, please check name and password / 登入失敗，請檢查姓名和密碼");
            }
        }
        
        // 工作人員登入
        function staffLogin() {
            const password = prompt(currentLang === 'zh' ? "請輸入管理員密碼 / Please enter admin password:" : "Please enter admin password / 請輸入管理員密碼:");
            
            if (password === "admin123") {
                currentAdmin = true;
                currentUser = { id: 0, name: "管理員 / Admin" };
                showSection('adminSection');
                renderUsersList();
                renderAdminRooms();
                renderAdminBookings();
            } else {
                alert(currentLang === 'zh' ? "管理員密碼錯誤 / Incorrect admin password" : "Incorrect admin password / 管理員密碼錯誤");
            }
        }
        
        // 登出
        function logout() {
            currentUser = null;
            currentAdmin = false;
            selectedBranch = null;
            selectedRoom = null;
            selectedDate = null;
            selectedTime = null;
            showSection('loginSection');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }
        
        // 顯示指定區域
        function showSection(sectionId) {
            document.querySelectorAll('.main-section, .login-section').forEach(section => {
                section.classList.remove('active-section');
            });
            document.getElementById(sectionId).classList.add('active-section');
            
            // 重置分頁
            if (sectionId === 'userSection') {
                switchTab('booking');
            } else if (sectionId === 'adminSection') {
                switchAdminTab('users');
            }
        }
        
        // 切換租用者分頁
        function switchTab(tab) {
            // 更新分頁按鈕狀態
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            
            // 顯示對應內容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active-section');
            });
            document.getElementById(`${tab}Tab`).classList.add('active-section');
            
            // 如果需要，更新內容
            if (tab === 'mybookings') {
                renderUserBookings();
            } else if (tab === 'stats') {
                renderUserStats();
            }
        }
        
        // 切換管理員分頁
        function switchAdminTab(tab) {
            // 更新按鈕狀態
            document.querySelectorAll('.admin-controls .btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-tab="${tab}"]`).classList.add('selected');
            
            // 顯示對應內容
            document.querySelectorAll('.admin-panel.tab-content').forEach(content => {
                content.classList.remove('active-section');
            });
            document.getElementById(`${tab}Tab`).classList.add('active-section');
        }
        
        // 渲染房間列表
        function renderRooms(branch) {
            if (!branch) return;
            
            const roomsContainer = document.getElementById('roomsContainer');
            const rooms = roomsData[branch];
            
            roomsContainer.innerHTML = '';
            
            rooms.forEach(room => {
                const roomCard = document.createElement('div');
                roomCard.className = 'room-card';
                roomCard.setAttribute('data-room', room.id);
                
                // 房間設施文本
                let facilitiesHTML = '';
                room.facilities.forEach(facility => {
                    facilitiesHTML += `<div class="room-facility"><i class="fas fa-check-circle"></i> ${facility}</div>`;
                });
                
                if (room.hasToys) {
                    facilitiesHTML += `<div class="room-facility"><i class="fas fa-plus-circle"></i> ${currentLang === 'zh' ? '可租用玩具 / Toys for rent' : 'Toys for rent / 可租用玩具'} (+$${room.toyPrice}/${currentLang === 'zh' ? '小時' : 'hour'})</div>`;
                }
                
                roomCard.innerHTML = `
                    <div class="room-header">
                        <div class="room-title">${room.name}</div>
                        <div class="room-price">$${room.price}/${currentLang === 'zh' ? '小時' : 'hour'}</div>
                    </div>
                    <div class="room-body">
                        ${facilitiesHTML}
                        <button class="btn btn-block select-room-btn" style="margin-top: 15px;">${currentLang === 'zh' ? '選擇房間 / Select Room' : 'Select Room / 選擇房間'}</button>
                    </div>
                `;
                
                roomsContainer.appendChild(roomCard);
            });
            
            // 添加房間選擇事件
            document.querySelectorAll('.select-room-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const roomCard = this.closest('.room-card');
                    selectedRoom = roomCard.getAttribute('data-room');
                    
                    // 高亮選中的房間
                    document.querySelectorAll('.room-card').forEach(card => {
                        card.style.border = 'none';
                    });
                    roomCard.style.border = `3px solid ${getComputedStyle(document.documentElement).getPropertyValue('--primary')}`;
                    
                    // 顯示玩具選項（如果適用）
                    const room = rooms.find(r => r.id === selectedRoom);
                    const toyOption = document.getElementById('toyOption');
                    if (room.hasToys) {
                        toyOption.style.display = 'block';
                        document.getElementById('toyPrice').textContent = room.toyPrice;
                    } else {
                        toyOption.style.display = 'none';
                    }
                    
                    // 更新預約按鈕狀態
                    updateConfirmButton();
                });
            });
        }
        
        // 渲染日曆
        function renderCalendar() {
            const monthNames = currentLang === 'zh' 
                ? ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"]
                : ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            
            document.getElementById('currentMonth').textContent = `${currentYear} ${monthNames[currentMonth]}`;
            
            // 計算該月的第一天和最後一天
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startingDay = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            // 清空日曆
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // 添加上個月的日期
            const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
            for (let i = startingDay - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.innerHTML = `<div class="day-number">${prevMonthLastDay - i}</div>`;
                calendarDays.appendChild(day);
            }
            
            // 添加當月的日期
            const today = new Date();
            const isToday = (day) => {
                return day === today.getDate() && 
                       currentMonth === today.getMonth() && 
                       currentYear === today.getFullYear();
            };
            
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                if (isToday(day)) {
                    dayElement.classList.add('today');
                }
                
                dayElement.innerHTML = `<div class="day-number">${day}</div>`;
                
                // 添加點擊事件
                dayElement.addEventListener('click', function() {
                    selectDate(day);
                });
                
                calendarDays.appendChild(dayElement);
            }
            
            // 添加下個月的日期
            const totalCells = 42; // 6 rows x 7 days
            const nextMonthDays = totalCells - (startingDay + lastDay.getDate());
            for (let day = 1; day <= nextMonthDays; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.innerHTML = `<div class="day-number">${day}</div>`;
                calendarDays.appendChild(dayElement);
            }
            
            // 渲染時間段（如果已選擇房間）
            if (selectedRoom) {
                renderTimeSlots();
            }
        }
        
        // 選擇日期
        function selectDate(day) {
            selectedDate = new Date(currentYear, currentMonth, day);
            const formattedDate = formatDate(selectedDate);
            
            // 更新顯示
            const dateInfo = document.getElementById('selectedDateInfo');
            dateInfo.textContent = currentLang === 'zh' 
                ? `已選擇: ${formattedDate} / Selected: ${formattedDate}` 
                : `Selected: ${formattedDate} / 已選擇: ${formattedDate}`;
            
            // 渲染時間段
            renderTimeSlots();
            
            // 更新預約按鈕狀態
            updateConfirmButton();
        }
        
        // 渲染時間段
        function renderTimeSlots() {
            if (!selectedDate || !selectedRoom) return;
            
            const timeSlotsContainer = document.getElementById('timeSlots');
            timeSlotsContainer.innerHTML = '';
            
            // 創建時間段 (9:00 AM 到 6:00 PM，每半小時)
            const startHour = 9;
            const endHour = 18;
            const formattedDate = formatDate(selectedDate);
            
            for (let hour = startHour; hour < endHour; hour++) {
                for (let minute of ['00', '30']) {
                    const time = `${hour.toString().padStart(2, '0')}:${minute}`;
                    const nextHour = minute === '30' ? hour + 1 : hour;
                    const nextMinute = minute === '30' ? '00' : '30';
                    const nextTime = `${nextHour.toString().padStart(2, '0')}:${nextMinute}`;
                    const timeSlot = `${time}-${nextTime}`;
                    
                    // 檢查該時間段是否已被預約
                    const isBooked = bookingsData.some(booking => 
                        booking.roomId === selectedRoom && 
                        booking.date === formattedDate && 
                        booking.time === timeSlot
                    );
                    
                    // 檢查是否是用戶自己的預約
                    const isMyBooking = currentUser && bookingsData.some(booking => 
                        booking.userId === currentUser.id && 
                        booking.roomId === selectedRoom && 
                        booking.date === formattedDate && 
                        booking.time === timeSlot
                    );
                    
                    const timeSlotBtn = document.createElement('button');
                    timeSlotBtn.className = 'time-slot-btn';
                    timeSlotBtn.textContent = timeSlot;
                    
                    if (isBooked && !isMyBooking) {
                        timeSlotBtn.classList.add('booked');
                        timeSlotBtn.disabled = true;
                        timeSlotBtn.title = currentLang === 'zh' ? '已預約 / Booked' : 'Booked / 已預約';
                    } else {
                        timeSlotBtn.addEventListener('click', function() {
                            // 取消選擇其他時間段
                            document.querySelectorAll('.time-slot-btn').forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            
                            this.classList.add('selected');
                            selectedTime = timeSlot;
                            
                            // 更新預約按鈕狀態
                            updateConfirmButton();
                        });
                    }
                    
                    timeSlotsContainer.appendChild(timeSlotBtn);
                }
            }
        }
        
        // 更新確認預約按鈕狀態
        function updateConfirmButton() {
            const confirmBtn = document.getElementById('confirmBooking');
            const isEnabled = selectedBranch && selectedRoom && selectedDate && selectedTime;
            confirmBtn.disabled = !isEnabled;
            
            if (isEnabled) {
                updateBookingPrice();
            }
        }
        
        // 更新預約價格
        function updateBookingPrice() {
            if (!selectedRoom || !selectedBranch) return;
            
            const room = roomsData[selectedBranch].find(r => r.id === selectedRoom);
            if (!room) return;
            
            const toyRental = document.getElementById('toyRental').checked;
            const duration = 0.5; // 預設半小時，可以擴展為可選擇時長
            
            let total = room.price * duration;
            if (toyRental && room.hasToys) {
                total += room.toyPrice * duration;
            }
            
            const confirmBtn = document.getElementById('confirmBooking');
            confirmBtn.textContent = currentLang === 'zh' 
                ? `確認預約 / Confirm Booking ($${total.toFixed(2)})` 
                : `Confirm Booking / 確認預約 ($${total.toFixed(2)})`;
        }
        
        // 確認預約
        function confirmBooking() {
            if (!selectedBranch || !selectedRoom || !selectedDate || !selectedTime || !currentUser) return;
            
            const room = roomsData[selectedBranch].find(r => r.id === selectedRoom);
            const toyRental = document.getElementById('toyRental').checked;
            const duration = 0.5; // 半小時
            
            let total = room.price * duration;
            if (toyRental && room.hasToys) {
                total += room.toyPrice * duration;
            }
            
            // 創建新的預約
            const newBooking = {
                id: bookingsData.length > 0 ? Math.max(...bookingsData.map(b => b.id)) + 1 : 1,
                userId: currentUser.id,
                userName: currentUser.name,
                roomId: selectedRoom,
                branch: selectedBranch,
                date: formatDate(selectedDate),
                time: selectedTime,
                duration: duration,
                price: room.price,
                toyRental: toyRental,
                total: total
            };
            
            bookingsData.push(newBooking);
            
            // 保存到GitHub (模擬)
            saveToGitHub();
            
            // 顯示成功消息
            alert(currentLang === 'zh' 
                ? `預約成功! / Booking successful!\n房間: ${room.name}\n日期: ${formatDate(selectedDate)}\n時間: ${selectedTime}\n總金額: $${total.toFixed(2)}`
                : `Booking successful! / 預約成功!\nRoom: ${room.name}\nDate: ${formatDate(selectedDate)}\nTime: ${selectedTime}\nTotal: $${total.toFixed(2)}`);
            
            // 重置選擇
            selectedRoom = null;
            selectedDate = null;
            selectedTime = null;
            document.getElementById('selectedDateInfo').textContent = currentLang === 'zh' 
                ? "請選擇一個日期 / Please select a date" 
                : "Please select a date / 請選擇一個日期";
            document.getElementById('toyOption').style.display = 'none';
            document.getElementById('confirmBooking').disabled = true;
            document.getElementById('confirmBooking').textContent = currentLang === 'zh' 
                ? "確認預約 / Confirm Booking" 
                : "Confirm Booking / 確認預約";
            
            // 重新渲染時間段和用戶預約
            renderTimeSlots();
            renderUserBookings();
        }
        
        // 渲染用戶預約
        function renderUserBookings() {
            if (!currentUser) return;
            
            const userBookingsList = document.getElementById('userBookingsList');
            userBookingsList.innerHTML = '';
            
            const userBookings = bookingsData.filter(booking => booking.userId === currentUser.id);
            
            if (userBookings.length === 0) {
                userBookingsList.innerHTML = `<p>${currentLang === 'zh' ? '暫無預約 / No bookings yet' : 'No bookings yet / 暫無預約'}</p>`;
                return;
            }
            
            // 按日期排序（最近的在前）
            userBookings.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            userBookings.forEach(booking => {
                const bookingItem = document.createElement('div');
                bookingItem.className = 'booking-item';
                
                // 查找房間名稱
                const room = roomsData[booking.branch].find(r => r.id === booking.roomId);
                const roomName = room ? room.name : booking.roomId;
                
                bookingItem.innerHTML = `
                    <div class="booking-details">
                        <h4>${roomName} (${booking.branch === 'Jordan' ? '佐敦' : booking.branch === 'WanChai' ? '灣仔' : '荃灣'} / ${booking.branch})</h4>
                        <p>${booking.date} | ${booking.time} | ${booking.duration} ${currentLang === 'zh' ? '小時' : 'hour'}</p>
                        <p>${booking.toyRental ? (currentLang === 'zh' ? '包含玩具租用 / Includes toy rental' : 'Includes toy rental / 包含玩具租用') + ' | ' : ''}總金額: $${booking.total.toFixed(2)}</p>
                    </div>
                    <div class="booking-actions">
                        <button class="btn cancel-booking-btn" data-id="${booking.id}">${currentLang === 'zh' ? '取消 / Cancel' : 'Cancel / 取消'}</button>
                    </div>
                `;
                
                userBookingsList.appendChild(bookingItem);
            });
            
            // 添加取消預約事件
            document.querySelectorAll('.cancel-booking-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bookingId = parseInt(this.getAttribute('data-id'));
                    cancelBooking(bookingId);
                });
            });
        }
        
        // 取消預約
        function cancelBooking(bookingId) {
            if (confirm(currentLang === 'zh' ? '確定要取消此預約嗎？/ Are you sure you want to cancel this booking?' : 'Are you sure you want to cancel this booking? / 確定要取消此預約嗎？')) {
                const index = bookingsData.findIndex(booking => booking.id === bookingId);
                if (index !== -1) {
                    bookingsData.splice(index, 1);
                    
                    // 保存到GitHub (模擬)
                    saveToGitHub();
                    
                    // 重新渲染相關內容
                    renderUserBookings();
                    renderAdminBookings();
                    
                    // 如果正在預約頁面，重新渲染時間段
                    if (selectedDate && selectedRoom) {
                        renderTimeSlots();
                    }
                    
                    alert(currentLang === 'zh' ? '預約已取消 / Booking cancelled' : 'Booking cancelled / 預約已取消');
                }
            }
        }
        
        // 渲染用戶統計
        function renderUserStats() {
            if (!currentUser) return;
            
            const monthInput = document.getElementById('statsMonth').value;
            const [year, month] = monthInput.split('-').map(Number);
            
            // 過濾該月的預約
            const userBookings = bookingsData.filter(booking => {
                if (booking.userId !== currentUser.id) return false;
                
                const bookingDate = new Date(booking.date);
                return bookingDate.getFullYear() === year && bookingDate.getMonth() + 1 === month;
            });
            
            // 計算統計數據
            const totalHours = userBookings.reduce((sum, booking) => sum + booking.duration, 0);
            const totalSessions = userBookings.length;
            const totalAmount = userBookings.reduce((sum, booking) => sum + booking.total, 0);
            const averagePerSession = totalSessions > 0 ? totalAmount / totalSessions : 0;
            
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = '';
            
            const stats = [
                { title: currentLang === 'zh' ? '總時數 / Total Hours' : 'Total Hours / 總時數', value: totalHours.toFixed(1) },
                { title: currentLang === 'zh' ? '總次數 / Total Sessions' : 'Total Sessions / 總次數', value: totalSessions },
                { title: currentLang === 'zh' ? '總金額 / Total Amount' : 'Total Amount / 總金額', value: `$${totalAmount.toFixed(2)}` },
                { title: currentLang === 'zh' ? '平均每次 / Average Per Session' : 'Average Per Session / 平均每次', value: `$${averagePerSession.toFixed(2)}` }
            ];
            
            stats.forEach(stat => {
                const statCard = document.createElement('div');
                statCard.className = 'stat-card';
                statCard.innerHTML = `
                    <h4>${stat.title}</h4>
                    <div class="stat-value">${stat.value}</div>
                `;
                statsGrid.appendChild(statCard);
            });
        }
        
        // 渲染用戶列表 (管理員)
        function renderUsersList() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';
            
            usersData.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                    <div>${user.name}</div>
                    <div>${user.phone}</div>
                    <div>${user.email}</div>
                    <div>${user.password}</div>
                    <div>
                        <button class="btn edit-user-btn" data-id="${user.id}">${currentLang === 'zh' ? '編輯 / Edit' : 'Edit / 編輯'}</button>
                        <button class="btn delete-user-btn" data-id="${user.id}">${currentLang === 'zh' ? '刪除 / Delete' : 'Delete / 刪除'}</button>
                    </div>
                `;
                usersList.appendChild(userItem);
            });
            
            // 添加事件監聽器
            document.querySelectorAll('.edit-user-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = parseInt(this.getAttribute('data-id'));
                    editUser(userId);
                });
            });
            
            document.querySelectorAll('.delete-user-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = parseInt(this.getAttribute('data-id'));
                    deleteUser(userId);
                });
            });
        }
        
        // 渲染管理員房間管理
        function renderAdminRooms() {
            const roomsContainer = document.querySelector('#roomsTab .room-grid');
            roomsContainer.innerHTML = '';
            
            // 合併所有房間
            let allRooms = [];
            for (const branch in roomsData) {
                roomsData[branch].forEach(room => {
                    allRooms.push({ ...room, branch });
                });
            }
            
            allRooms.forEach(room => {
                const roomCard = document.createElement('div');
                roomCard.className = 'room-card';
                
                // 房間設施文本
                let facilitiesHTML = '';
                room.facilities.forEach(facility => {
                    facilitiesHTML += `<div class="room-facility"><i class="fas fa-check-circle"></i> ${facility}</div>`;
                });
                
                if (room.hasToys) {
                    facilitiesHTML += `<div class="room-facility"><i class="fas fa-plus-circle"></i> ${currentLang === 'zh' ? '可租用玩具 / Toys for rent' : 'Toys for rent / 可租用玩具'} (+$${room.toyPrice}/${currentLang === 'zh' ? '小時' : 'hour'})</div>`;
                }
                
                roomCard.innerHTML = `
                    <div class="room-header">
                        <div class="room-title">${room.name} (${room.branch === 'Jordan' ? '佐敦' : room.branch === 'WanChai' ? '灣仔' : '荃灣'})</div>
                        <div class="room-price">$${room.price}/${currentLang === 'zh' ? '小時' : 'hour'}</div>
                    </div>
                    <div class="room-body">
                        ${facilitiesHTML}
                        <button class="btn btn-block edit-room-btn" style="margin-top: 15px;" data-id="${room.id}" data-branch="${room.branch}">${currentLang === 'zh' ? '編輯價格 / Edit Price' : 'Edit Price / 編輯價格'}</button>
                    </div>
                `;
                
                roomsContainer.appendChild(roomCard);
            });
            
            // 添加編輯房間事件
            document.querySelectorAll('.edit-room-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const roomId = this.getAttribute('data-id');
                    const branch = this.getAttribute('data-branch');
                    editRoomPrice(roomId, branch);
                });
            });
        }
        
        // 渲染所有預約 (管理員)
        function renderAdminBookings() {
            const adminBookingsList = document.getElementById('adminBookingsList');
            adminBookingsList.innerHTML = '';
            
            const monthInput = document.getElementById('adminMonth').value;
            const [year, month] = monthInput.split('-').map(Number);
            
            // 過濾該月的預約
            const monthBookings = bookingsData.filter(booking => {
                const bookingDate = new Date(booking.date);
                return bookingDate.getFullYear() === year && bookingDate.getMonth() + 1 === month;
            });
            
            if (monthBookings.length === 0) {
                adminBookingsList.innerHTML = `<div class="booking-row">${currentLang === 'zh' ? '本月暫無預約 / No bookings this month' : 'No bookings this month / 本月暫無預約'}</div>`;
                return;
            }
            
            // 按日期排序
            monthBookings.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            monthBookings.forEach(booking => {
                const bookingRow = document.createElement('div');
                bookingRow.className = 'booking-row';
                
                // 查找房間名稱
                const room = roomsData[booking.branch].find(r => r.id === booking.roomId);
                const roomName = room ? room.name : booking.roomId;
                
                bookingRow.innerHTML = `
                    <div>${booking.userName}</div>
                    <div>${roomName} (${booking.branch === 'Jordan' ? '佐敦' : booking.branch === 'WanChai' ? '灣仔' : '荃灣'})</div>
                    <div>${booking.date}</div>
                    <div>${booking.time}</div>
                    <div>$${booking.total.toFixed(2)}</div>
                    <div>
                        <button class="btn admin-cancel-booking-btn" data-id="${booking.id}">${currentLang === 'zh' ? '取消 / Cancel' : 'Cancel / 取消'}</button>
                    </div>
                `;
                
                adminBookingsList.appendChild(bookingRow);
            });
            
            // 添加取消預約事件 (管理員)
            document.querySelectorAll('.admin-cancel-booking-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bookingId = parseInt(this.getAttribute('data-id'));
                    cancelBooking(bookingId);
                });
            });
        }
        
        // 新增用戶
        function addNewUser() {
            const name = prompt(currentLang === 'zh' ? '請輸入租用者姓名 (中英文) / Enter user name (Chinese/English):' : 'Enter user name (Chinese/English) / 請輸入租用者姓名 (中英文):');
            if (!name) return;
            
            const phone = prompt(currentLang === 'zh' ? '請輸入聯絡電話 / Enter phone number:' : 'Enter phone number / 請輸入聯絡電話:');
            const email = prompt(currentLang === 'zh' ? '請輸入電子郵件 / Enter email:' : 'Enter email / 請輸入電子郵件:');
            
            // 生成預設密碼
            const defaultPassword = "123";
            
            const newUser = {
                id: usersData.length > 0 ? Math.max(...usersData.map(u => u.id)) + 1 : 1,
                name: name,
                phone: phone || '',
                email: email || '',
                password: defaultPassword
            };
            
            usersData.push(newUser);
            
            // 保存到GitHub (模擬)
            saveToGitHub();
            
            // 重新渲染用戶列表
            renderUsersList();
            
            alert(currentLang === 'zh' 
                ? `用戶新增成功! / User added successfully!\n密碼: ${defaultPassword} (可稍後更改)`
                : `User added successfully! / 用戶新增成功!\nPassword: ${defaultPassword} (can be changed later)`);
        }
        
        // 編輯用戶
        function editUser(userId) {
            const user = usersData.find(u => u.id === userId);
            if (!user) return;
            
            const newName = prompt(currentLang === 'zh' ? '請輸入新姓名 / Enter new name:' : 'Enter new name / 請輸入新姓名:', user.name);
            if (!newName) return;
            
            const newPhone = prompt(currentLang === 'zh' ? '請輸入新聯絡電話 / Enter new phone number:' : 'Enter new phone number / 請輸入新聯絡電話:', user.phone);
            const newEmail = prompt(currentLang === 'zh' ? '請輸入新電子郵件 / Enter new email:' : 'Enter new email / 請輸入新電子郵件:', user.email);
            const newPassword = prompt(currentLang === 'zh' ? '請輸入新密碼 / Enter new password:' : 'Enter new password / 請輸入新密碼:', user.password);
            
            user.name = newName;
            user.phone = newPhone || '';
            user.email = newEmail || '';
            user.password = newPassword || user.password;
            
            // 保存到GitHub (模擬)
            saveToGitHub();
            
            // 重新渲染用戶列表
            renderUsersList();
            
            alert(currentLang === 'zh' ? '用戶資料已更新 / User updated successfully' : 'User updated successfully / 用戶資料已更新');
        }
        
        // 刪除用戶
        function deleteUser(userId) {
            if (confirm(currentLang === 'zh' ? '確定要刪除此用戶嗎？/ Are you sure you want to delete this user?' : 'Are you sure you want to delete this user? / 確定要刪除此用戶嗎？')) {
                const index = usersData.findIndex(u => u.id === userId);
                if (index !== -1) {
                    // 檢查用戶是否有預約
                    const userBookings = bookingsData.filter(b => b.userId === userId);
                    if (userBookings.length > 0) {
                        if (!confirm(currentLang === 'zh' 
                            ? `此用戶有 ${userBookings.length} 個預約，確定要刪除嗎？/ This user has ${userBookings.length} bookings, are you sure you want to delete?` 
                            : `This user has ${userBookings.length} bookings, are you sure you want to delete? / 此用戶有 ${userBookings.length} 個預約，確定要刪除嗎？`)) {
                            return;
                        }
                    }
                    
                    usersData.splice(index, 1);
                    
                    // 保存到GitHub (模擬)
                    saveToGitHub();
                    
                    // 重新渲染用戶列表
                    renderUsersList();
                    
                    alert(currentLang === 'zh' ? '用戶已刪除 / User deleted' : 'User deleted / 用戶已刪除');
                }
            }
        }
        
        // 編輯房間價格
        function editRoomPrice(roomId, branch) {
            const room = roomsData[branch].find(r => r.id === roomId);
            if (!room) return;
            
            const newPrice = prompt(currentLang === 'zh' 
                ? `請輸入 ${room.name} 的新租金 (每小時) / Enter new price for ${room.name} (per hour):` 
                : `Enter new price for ${room.name} (per hour) / 請輸入 ${room.name} 的新租金 (每小時):`, room.price);
            
            if (!newPrice || isNaN(newPrice)) return;
            
            room.price = parseFloat(newPrice);
            
            // 保存到GitHub (模擬)
            saveToGitHub();
            
            // 重新渲染房間
            renderAdminRooms();
            
            alert(currentLang === 'zh' 
                ? `房間租金已更新 / Room price updated\n新租金: $${room.price}/${currentLang === 'zh' ? '小時' : 'hour'}`
                : `Room price updated / 房間租金已更新\nNew price: $${room.price}/${currentLang === 'zh' ? '小時' : 'hour'}`);
        }
        
        // 列印報告
        function printReport() {
            window.print();
        }
        
        // 從GitHub加載數據 (模擬)
        function loadFromGitHub() {
            // 在實際應用中，這裡會從GitHub API加載數據
            console.log("從GitHub加載數據... / Loading data from GitHub...");
            
            // 模擬從本地存儲加載
            const savedBookings = localStorage.getItem('psychologistBookings');
            const savedUsers = localStorage.getItem('psychologistUsers');
            
            if (savedBookings) {
                bookingsData = JSON.parse(savedBookings);
            }
            
            if (savedUsers) {
                usersData = JSON.parse(savedUsers);
            }
        }
        
        // 保存到GitHub (模擬)
        function saveToGitHub() {
            // 在實際應用中，這裡會通過GitHub API保存數據
            console.log("保存數據到GitHub... / Saving data to GitHub...");
            
            // 模擬保存到本地存儲
            localStorage.setItem('psychologistBookings', JSON.stringify(bookingsData));
            localStorage.setItem('psychologistUsers', JSON.stringify(usersData));
        }
        
        // 輔助函數：格式化日期為YYYY-MM-DD
        function formatDate(date) {
            if (!date) return '';
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
    </script>
</body>
</html>
